<!doctype html>
<html>
  <head>
    <meta charset="utf-8">

    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

    <!-- Use title if it's in the page YAML frontmatter -->
    <title>Deploying Micro BOSH</title>

    <link href="/stylesheets/master.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/style.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/all.js" type="text/javascript"></script>
    <link href='/images/favicon.ico' rel='shortcut icon'>
    <script type="text/javascript">
      $(document).ready(function(){
        $('a#search').click(function () {
          $('#organization_bar .navbar .nav>li a').css("padding","11px 20px 8px");
          $('#organization_bar .navbar .nav>li a#docs').css("padding","14px 20px");
          $('#organization_bar .navbar .nav>li a#search2').css("padding","11px 10px 8px");
          $('#search-on').show();
          $('#search-off').hide();
        });
        $('.cancel-x').click(function () {
          $('#organization_bar .navbar .nav>li a').css("padding","11px 63px 8px");
          $('#organization_bar .navbar .nav>li a#docs').css("padding","14px 20px");
          $('#organization_bar .navbar .nav>li a#search2, #organization_bar .navbar .nav>li a#search').css("padding","16px 20px 15px");
          $('#organization_bar .navbar .nav>li a#getinvolved').css("padding","11px 92px 8px");
          $('#organization_bar .navbar .nav>li#docs-off .docs-list-list a').css("padding","0");
          $('#search-on').hide();
          $('#search-off').show();
        });f
        $(".togglebutton").click(function () {
        var divname= this.value;
          $("#"+divname).show("slow").siblings().hide("slow");
        });
      });
    </script>

    <!--[if lt IE 9]>
    <style>
        #content .container-full {background:  #ebf0fa;}
        .call-to-contribute-box, .column-left, .column-middle, .column-right {background:#e3e8f2}
        #footer {background:#000;}
    </style>
    <![endif]-->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-22181585-1']);
      _gaq.push(['_setDomainName', 'cloudfoundry.com']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>

  <body class="docs docs_running docs_running_deploying-cf docs_running_deploying-cf_openstack docs_running_deploying-cf_openstack_deploying_microbosh">
    <img id="bg" src="/images/bg-plain-x.jpg">
    <div id='non_footer'>
      <div id='header'>
        <div class='container_wide'>
          <ul class='actions'>
            <li class='last'>
              <a href="http://www.cloudfoundry.com/contact">Contact Us</a>
            </li>
            <li>
              <a class='register_link' href='http://login.run.pivotal.io/login'>My Account</a>            
            </li>
          </ul>
        </div>
      </div>
      <div id='content'>
        <div class='logo-main'>
          <div class='logo'>
            <a href='http://www.cloudfoundry.com'>
            <img src='/images/logo-cloudfoundry.png'>
            </a>
            <a href='http://www.gopivotal.com' target="_blank">
            <img id="pivotal-logo" src='/images/logo-pivotal.png'>
            </a>
          </div>
          <div class='cta'>
            <a href='https://console.run.pivotal.io'>
            <img src='/images/signup_freetrial.png'>
            </a>
          </div>
        </div><!-- End of logo-main-->
        <div class='container-full'>
          <div id='organization_bar'>
            <div class='navbar'>
              <ul class='nav'>
                <li>
                <a href='http://www.cloudfoundry.com/use' id='use'>Using Cloud Foundry</a>
                </li>
                <li>
                <a href='http://www.cloudfoundry.com/run' id='run'>Running Cloud Foundry</a>
                </li>
                <li>
                <a href='http://www.cloudfoundry.com/getinvolved' id='getinvolved'>Get Involved</a>
                </li>
                <li id='docs-off'>
                  <a href='/' id='docs'>
                    <div id='icon-docs'></div>
                  </a>
                  <div id='docs-list'>
                    <div class="docs-list-list">
                      <a class="docs-list-th" href='/docs/using/app-arch/'>Using Cloud Foundry</a>
                      <br>
                      <a href="/docs/using/app-arch/">Application Architecture Considerations</a>
                      <br>
                      <a href='/docs/using/deploying-apps/'>Deploying Apps</a>
                      <br>
                      <a href='/docs/using/managing-apps/'>Managing Apps</a>
                      <br>
                      <a href='/docs/using/services.html'>Using Services</a>
                      <br>
                      <a class="docs-list-see-all" href="/docs/using/">See all</a>
                    </div><!-- End of 1st column docs-list-list-->
                    <div class="hr-vertical"></div>
                    <div class="docs-list-list">
                      <a class="docs-list-th" href='/docs/running/'>Running Cloud Foundry</a>
                      <br>
                      <a href='/docs/running/architecture/'>Architecture</a>
                      <br>
                      <a href='/docs/running/bosh/'>BOSH</a>
                      <br>
                      <a href='/docs/running/deploying-cf/'>Deploying with BOSH</a>
                      <br>
                      <a href='/docs/running/deploying-cf-with-chef/'>Deploying with Chef</a>
                      <br>
                      <a href='/docs/running/micro_cloud_foundry/'>Micro Cloud Foundry</a>
                      <br>
                      <a href='/docs/running/managing-cf/index.html'>Managing Cloud Foundry</a>
                      <br>
                      <a class="docs-list-see-all" href="/docs/running/">See all</a>
                    </div><!-- End of column 2 docs-list-list -->
                    <div class="hr-vertical"></div>
                    <div class="docs-list-list">
                      <a class="docs-list-th" href='/docs/reference/'>Reference</a>
                      <br>
                      <a href='/docs/reference/cc-api.html'>Cloud Foundry REST API</a>
                      <br>
                      <a class="docs-list-th" href='/docs/dotcom/'>CloudFoundry.com</a>
                      <br>
                      <a href='/docs/dotcom/integration/'>Technical Integration</a>
                      <br>
                      <a class="docs-list-th" href='/docs/community/'>Community</a>
                    </div><!-- End of column 3 docs-list-list -->
                  </div><!-- End of docs-list -->
                </li>
                <li id='search-off'>
                  <a id='search'>
                    <div class='icon-search'></div>
                  </a>
                </li>
                <li id='search-on'>
                  <a id='search2'>
                    <form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
                      <input autocomplete='off' class='search-input' id='search-query' name='q' onfocus="this.placeholder = ''" placeholder='' type='search' value=''>
                    </form>
                    <div class="cancel-x"></div>
                  </a>
                </li>
              </ul>
            </div><!-- End of navbar -->
          </div><!-- End of organization_bar -->
          <div class='content_inner'>
            <a class="forkme" href="http://github.com/cloudfoundry/cf-docs" target="_blank">
              <img alt="Fork me on GitHub" src="/images/ribbon_forkme.png">
            </a>
            <form action='http://www.cloudfoundry.com/search' class='search-docs-form' method='get' onsubmit='return submitQuery()'>
              <input autocomplete='off' class='search-docs-input' id='search-query' name='q' onfocus="this.placeholder = 'more:docs '" placeholder='' type='search-docs' value='more:docs '>
            </form>
            <br clear="left">
            
              <div class="breadcrumbs">
                <ul>
                  <li>
                    <a href="/">Home</a>
                  </li>
                  <li class=""><a href="/docs/running/">Running Cloud Foundry</a></li> <li class=""><a href="/docs/running/deploying-cf/">Deploying Cloud Foundry with BOSH</a></li> <li class=""><a href="/docs/running/deploying-cf/openstack/">Deploying Cloud Foundry on OpenStack</a></li> <li class="active"><span>Deploying Micro BOSH</span></li>
                </ul>
              </div>
              <br clear="left">

			

              <div class="quick-links"><ul>
<li><a href="#prerequisites">Prerequisites</a>

<ul>
<li><a href="#bosh_cli">BOSH CLI</a></li>
<li><a href="#openstack_services">OpenStack Services</a></li>
<li><a href="#openstack_security_groups">OpenStack Security Groups</a></li>
<li><a href="#openstack_keypairs">OpenStack Key pairs</a></li>
<li><a href="#openstack_validate">Validate your OpenStack</a></li>
</ul></li>
<li><a href="#deploy_microbosh">Deploying Micro BOSH</a>

<ul>
<li><a href="#manifest_file">Create manifest file</a></li>
<li><a href="#download_stemcell">Download Micro BOSH stemcell</a></li>
<li><a href="#deploy">Deploy Micro BOSH</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
</ul></li>
<li><a href="#test_microbosh">Testing your Micro BOSH</a>

<ul>
<li><a href="#microbosh_target">Set target</a></li>
<li><a href="#microbosh_create_user">Create a new user</a></li>
<li><a href="#microbosh_status">Check status</a></li>
<li><a href="#microbosh_ssh">SSH</a></li>
</ul></li>
<li><a href="#delete_microbosh">Deleting your Micro BOSH</a></li>
</ul>
</div>

              <h1>Deploying Micro BOSH</h1>

            
            <p>Installation of BOSH is done using micro BOSH, which is a single VM that includes all of the <a href="/docs/running/bosh/components/">BOSH components</a>. If you want to play around with BOSH, or create a simple development setup, you can install micro BOSH using the BOSH Deployer. If you would like to use BOSH in production to manage a distributed system, you also use the BOSH Deployer, install micro BOSH, and then use it as a means to deploy the final distributed system on multiple VMs.</p>

<p>A good way to think about this two step process is to consider that BOSH is a distributed system in itself. Since BOSH&#39;s core purpose is to deploy and manage distributed systems, it makes sense that we would use it to deploy itself. On the BOSH team, we gleefully refer to this as <a href="http://en.wikipedia.org/wiki/Inception">Inception</a>.</p>

<h2><a id="prerequisites"></a>Prerequisites</h2>

<h3><a id="bosh_cli"></a>BOSH CLI</h3>

<p>Install the <a href="/docs/running/bosh/setup/">BOSH CLI</a>.</p>

<h3><a id="openstack_services"></a>OpenStack Services</h3>

<p>Micro BOSH needs a running OpenStack environment. Only <a href="https://wiki.openstack.org/wiki/ReleaseNotes/Folsom">Folsom</a> and <a href="https://wiki.openstack.org/wiki/ReleaseNotes/Grizzly">Grizzly</a> OpenStack releases are supported.</p>

<p>You will need access to these OpenStack services:</p>

<ul>
<li><a href="http://www.openstack.org/software/openstack-shared-services/">Identity</a>: Micro BOSH will authenticate your credentials trought the identity server and get the endpoint URLs for other OpenStack services.</li>
<li><a href="http://www.openstack.org/software/openstack-compute/">Compute</a>: Micro BOSH will boot new vms, assign floating IPs to vm, and create and attach volumes to vms.</li>
<li><a href="http://www.openstack.org/software/openstack-shared-services/">Image</a>: Micro BOSH will update new images (called <a href="/docs/running/bosh/components/stemcell.html">BOSH Stemcells</a> in BOSH terminology).</li>
</ul>

<p>Although the new <a href="http://www.openstack.org/software/openstack-networking/">OpenStack Networking</a> service is not required, it is recommended if you want to deploy complex distributed systems.</p>

<h3><a id="openstack_security_groups"></a>OpenStack Security Groups</h3>

<p>Ensure that you have created the <a href="/docs/running/deploying-cf/common/security_groups.html">Security Groups required</a>.</p>

<p>The ports required for bosh are:</p>

<ul>
<li>All ports (from <code>1</code> to <code>65535</code>) where the source group is the current security group</li>
<li>Port <code>22</code> from source 0.0.0.0/0 (CIDR): Used for inbound SSH access</li>
<li>Port <code>53</code> from source 0.0.0.0/0 (CIDR): Used for inbound DNS requests</li>
<li>Port <code>4222</code> from source 0.0.0.0/0 (CIDR): Used by <a href="/docs/running/bosh/components/messaging.html">NATS</a></li>
<li>Port <code>6868</code> from source 0.0.0.0/0 (CIDR): Used by <a href="/docs/running/bosh/components/agent.html">BOSH Agent</a></li>
<li>Port <code>25250</code> from source 0.0.0.0/0 (CIDR): Used by <a href="/docs/running/bosh/components/blobstore.html">BOSH Blobstore</a></li>
<li>Port <code>25555</code> from source 0.0.0.0/0 (CIDR): Used by <a href="/docs/running/bosh/components/director.html">BOSH Director</a></li>
<li>Port <code>25777</code> from source 0.0.0.0/0 (CIDR): Used by BOSH Registry</li>
</ul>

<h3><a id="openstack_keypairs"></a>OpenStack Key pairs</h3>

<p>Create or import a new OpenStack keypair, name it ie <code>microbosh</code>. Store the private key in a well know location, as we will need it to deploy Micro BOSH.</p>

<h3><a id="openstack_validate"></a>Validate your OpenStack</h3>

<p><a href="/docs/running/deploying-cf/openstack/validate_openstack.html">Validate</a> your target OpenStack environment in preparation for installing Micro BOSH.</p>

<h2><a id="deploy_microbosh"></a>Deploying Micro BOSH</h2>

<h3><a id="manifest_file"></a>Create manifest file</h3>

<p>Create a <code>deployments</code> directory to store your deployment manifest files:</p>

<pre class="terminal">
mkdir -p ~/bosh-workspace/deployments/microbosh-openstack
cd ~/bosh-workspace/deployments/microbosh-openstack
</pre>

<p>Create a <code>micro_bosh.yml</code> file and copy the below content:</p>
<pre class="highlight yaml"><span class="nn">---</span>
<span class="s">name</span><span class="p">:</span> <span class="s">microbosh-openstack</span>

<span class="s">logging</span><span class="p">:</span>
  <span class="s">level</span><span class="p">:</span> <span class="s">DEBUG</span>

<span class="s">network</span><span class="p">:</span>
  <span class="s">type</span><span class="p">:</span> <span class="s">manual</span>
  <span class="s">vip</span><span class="p">:</span> <span class="s">&lt;allocated_floating_ip&gt;</span> <span class="c1"># Optional</span>
  <span class="s">ip</span><span class="p">:</span> <span class="s">&lt;static_ip&gt;</span>
  <span class="s">cloud_properties</span><span class="p">:</span>
    <span class="s">net_id</span><span class="p">:</span> <span class="s">&lt;network_uuid&gt;</span>

<span class="s">resources</span><span class="p">:</span>
  <span class="s">persistent_disk</span><span class="p">:</span> <span class="s">16384</span>
  <span class="s">cloud_properties</span><span class="p">:</span>
    <span class="s">instance_type</span><span class="p">:</span> <span class="s">&lt;flavor_name&gt;</span>

<span class="s">cloud</span><span class="p">:</span>
  <span class="s">plugin</span><span class="p">:</span> <span class="s">openstack</span>
  <span class="s">properties</span><span class="p">:</span>
    <span class="s">openstack</span><span class="p">:</span>
      <span class="s">auth_url</span><span class="p">:</span> <span class="s">http://&lt;identity_server&gt;:5000/v2.0</span>
      <span class="s">username</span><span class="p">:</span> <span class="s">&lt;username&gt;</span>
      <span class="s">api_key</span><span class="p">:</span> <span class="s">&lt;password&gt;</span>
      <span class="s">tenant</span><span class="p">:</span> <span class="s">&lt;tenant&gt;</span>
      <span class="s">region</span><span class="p">:</span> <span class="s">&lt;region&gt;</span> <span class="c1"># Optional</span>
      <span class="s">default_security_groups</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;</span><span class="s">ssh&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">bosh&quot;</span><span class="p">]</span>
      <span class="s">default_key_name</span><span class="p">:</span> <span class="s">&lt;microbosh_keypair&gt;</span>
      <span class="s">private_key</span><span class="p">:</span> <span class="s">&lt;path_to_microbosh_keypar_private_key&gt;</span>

<span class="s">apply_spec</span><span class="p">:</span>
  <span class="s">properties</span><span class="p">:</span>
    <span class="s">director</span><span class="p">:</span>
      <span class="s">max_threads</span><span class="p">:</span> <span class="s">3</span>
    <span class="s">hm</span><span class="p">:</span>
      <span class="s">resurrector_enabled</span><span class="p">:</span> <span class="s">true</span>
    <span class="s">ntp</span><span class="p">:</span>
      <span class="p">-</span> <span class="s">0.north-america.pool.ntp.org</span>
      <span class="p">-</span> <span class="s">1.north-america.pool.ntp.org</span>
</pre>
<p>Adapt the <code>micro_bosh.yml</code> file to your environment settings:</p>

<h4><a id="network_properties"></a>Network properties</h4>

<p>This section sets the network configuration for your Micro BOSH.</p>

<p>If you are using nova-network, adapt the network section with below settings:</p>
<pre class="highlight yaml"><span class="s">network</span><span class="p">:</span>
  <span class="s">type</span><span class="p">:</span> <span class="s">dynamic</span>
  <span class="s">vip</span><span class="p">:</span> <span class="s">&lt;allocated_floating_ip&gt;</span> <span class="c1"># Optional</span>
</pre>
<ul>
<li>The <code>vip</code> option is optional, and allows you to associate a floating IP adress to the Micro Bosh vm in case you want to access it from outside of the vm network. If set, <code>allocated_floating_ip</code> <strong>must</strong> be a previously allocated floating ip.</li>
</ul>

<p>If you are using the new <a href="http://www.openstack.org/software/openstack-networking/">OpenStack Networking</a> component, adapt the network section with below settings:</p>

<ol>
<li>If your network has DHCP enabled, you can let OpenStack pick an IP address:</li>
</ol>
<pre class="highlight yaml"><span class="s">network</span><span class="p">:</span>
  <span class="s">type</span><span class="p">:</span> <span class="s">dynamic</span>
  <span class="s">vip</span><span class="p">:</span> <span class="s">&lt;allocated_floating_ip&gt;</span> <span class="c1"># Optional</span>
  <span class="s">cloud_properties</span><span class="p">:</span>
    <span class="s">net_id</span><span class="p">:</span> <span class="s">&lt;network_uuid&gt;</span>
</pre>
<ul>
<li>The <code>vip</code> option is optional, and allows you to associate a floating IP adress to the Micro Bosh vm in case you want to access it from outside of the vm network. If set, <code>allocated_floating_ip</code> <strong>must</strong> be a previously allocated floating ip.</li>
<li>The <code>net_id</code> option sets the OpenStack network to use. <code>network_uuid</code> <strong>must</strong> be an existing Network UUID (you can list your OpenStack networks using the command <code>quantum net-list</code>).</li>
</ul>

<ol>
<li>If you want to set the Micro Bosh IP address manually:</li>
</ol>
<pre class="highlight yaml"><span class="s">network</span><span class="p">:</span>
  <span class="s">type</span><span class="p">:</span> <span class="s">manual</span>
  <span class="s">vip</span><span class="p">:</span> <span class="s">&lt;allocated_floating_ip&gt;</span> <span class="c1"># Optional</span>
  <span class="s">ip</span><span class="p">:</span> <span class="s">&lt;static_ip&gt;</span>
  <span class="s">cloud_properties</span><span class="p">:</span>
    <span class="s">net_id</span><span class="p">:</span> <span class="s">&lt;network_uuid&gt;</span>
</pre>
<ul>
<li>The <code>vip</code> option is optional, and allows you to associate a floating IP adress to the Micro Bosh vm in case you want to access it from outside of the vm network. If set, <code>allocated_floating_ip</code> <strong>must</strong> be a previously allocated floating ip.</li>
<li>The <code>ip</code> option sets the IP address to assign to the Micro BOSH vm. <code>static_ip</code> <strong>must</strong> be an IP address belowing to the IP range of one of the network subnets set in <code>net_id</code>.</li>
<li>The <code>net_id</code> option sets the OpenStack network to use. <code>network_uuid</code> <strong>must</strong> be an existing Network UUID (you can list your OpenStack networks using the command <code>quantum net-list</code>).</li>
</ul>

<h4><a id="resources_properties"></a>Resources properties</h4>

<p>This section sets the resources configuration for your Micro Bosh.</p>
<pre class="highlight yaml"><span class="s">resources</span><span class="p">:</span>
  <span class="s">persistent_disk</span><span class="p">:</span> <span class="s">16384</span>
  <span class="s">cloud_properties</span><span class="p">:</span>
    <span class="s">instance_type</span><span class="p">:</span> <span class="s">&lt;flavor_name&gt;</span>
</pre>
<ul>
<li>The <code>persistent_disk</code> indicates that a new 16Gb volume will be created and attached to the Micro BOSH vm. On this disk, Micro BOSH will store the data, so in case you reboot or when upgrading the Micro BOSH vm, no data will be lost.</li>
<li>The <code>instance_type</code> set the OpenStack flavor used for the Micro BOSH vm. The <code>flavor_name</code> <strong>must</strong> have ephemeral disk (check the <a href="/docs/running/deploying-cf/openstack/validate_openstack.html#ephemeral">validate your OpenStack</a> guide)</li>
</ul>

<h4><a id="cloud_properties"></a>Cloud properties</h4>

<p>This section sets the cloud configuration for your Micro BOSH.</p>
<pre class="highlight yaml"><span class="s">cloud</span><span class="p">:</span>
  <span class="s">plugin</span><span class="p">:</span> <span class="s">openstack</span>
  <span class="s">properties</span><span class="p">:</span>
    <span class="s">openstack</span><span class="p">:</span>
      <span class="s">auth_url</span><span class="p">:</span> <span class="s">http://&lt;identity_server&gt;:5000/v2.0</span>
      <span class="s">username</span><span class="p">:</span> <span class="s">&lt;username&gt;</span>
      <span class="s">api_key</span><span class="p">:</span> <span class="s">&lt;password&gt;</span>
      <span class="s">tenant</span><span class="p">:</span> <span class="s">&lt;tenant&gt;</span>
      <span class="s">region</span><span class="p">:</span> <span class="s">&lt;region&gt;</span> <span class="c1"># Optional</span>
      <span class="s">default_security_groups</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;</span><span class="s">default&quot;</span><span class="p">,</span> <span class="nv">&lt;microbosh_security_group&gt;</span><span class="p">]</span>
      <span class="s">default_key_name</span><span class="p">:</span> <span class="s">&lt;microbosh_keypair&gt;</span>
      <span class="s">private_key</span><span class="p">:</span> <span class="s">&lt;path_to_microbosh_keypar_private_key&gt;</span>
</pre>
<ul>
<li>The <code>auth_url</code> option set your <a href="http://www.openstack.org/software/openstack-shared-services/">OpenStack identity</a> server.</li>
<li>The <code>username</code>, <code>api_key</code> and <code>tenant</code> options sets your OpenStack credentials.</li>
<li>The <code>region</code> option is optional, and allows you to set the OpenStack region to be used.</li>
<li>The <code>default_security_groups</code> option set the security groups used by Micro BOSH. The <code>microbosh_security_group</code> <strong>must</strong> be an existing security group (check the <a href="#openstack_security_groups">prerequisites</a> section).</li>
<li>The <code>default_key_name</code> and <code>private_key</code> options sets the key pair used by Micro BOSH. The <code>microbosh_keypair</code> <strong>must</strong> be an existing keypair (check the <a href="#openstack_keypairs">prerequisites</a> section).</li>
</ul>

<h4><a id="apply_spec_properties"></a>Apply Spec properties</h4>

<p>This section sets the specification configuration for your Micro BOSH.</p>
<pre class="highlight yaml"><span class="s">apply_spec</span><span class="p">:</span>
  <span class="s">properties</span><span class="p">:</span>
    <span class="s">director</span><span class="p">:</span>
      <span class="s">max_threads</span><span class="p">:</span> <span class="s">3</span>
    <span class="s">hm</span><span class="p">:</span>
      <span class="s">resurrector_enabled</span><span class="p">:</span> <span class="s">true</span>
    <span class="s">ntp</span><span class="p">:</span>
      <span class="p">-</span> <span class="s">0.north-america.pool.ntp.org</span>
      <span class="p">-</span> <span class="s">1.north-america.pool.ntp.org</span>
</pre>
<ul>
<li>The <code>properties</code> option allows you to add or override the settings to be applied to your Micro BOSH (by default it will use the <a href="https://github.com/cloudfoundry/bosh/blob/master/release/micro/openstack.yml">micro</a> apply spec).</li>
</ul>

<p>In this example we add/override several properties:</p>

<ul>
<li><code>director.max_threads</code> sets the number of concurrent threads Micro BOSH <a href="/docs/running/bosh/components/director.html">director</a> will use to perform some actions (ie: the number of parallel <code>create vm</code> tasks), so set this option according to your OpenStack environment (if not set, the default is 32 concurrent threads).</li>
<li><code>hm.resurrector_enabled</code> enables the <a href="/docs/running/bosh/components/health-monitor.html">BOSH Health Monitor</a> resurrector plugin. This plugin will lookup for jobs in a down state, and will try to resurrect (bring up) them.</li>
<li><code>ntp</code> sets the <a href="http://www.ntp.org/">Internet Time Servers</a> to be used to synchronize the clocks of new vms.</li>
</ul>

<h3><a id="download_stemcell"></a>Download Micro BOSH stemcell</h3>

<p>Create a <code>stemcells</code> directory to store your stemcell files:</p>

<pre class="terminal">
mkdir -p ~/bosh-workspace/stemcells
cd ~/bosh-workspace/stemcells
</pre>

<p>Download the latest OpenStack Micro BOSH stemcell:</p>

<pre class="terminal">
$ bosh public stemcells
+---------------------------------------------+
| Name                                        |
+---------------------------------------------+
| bosh-stemcell-1365-aws-xen-ubuntu.tgz       |
| light-bosh-stemcell-1365-aws-xen-ubuntu.tgz |
| bosh-stemcell-1365-openstack-kvm-ubuntu.tgz |
| bosh-stemcell-1365-vsphere-esxi-ubuntu.tgz  |
| bosh-stemcell-1365-vsphere-esxi-centos.tgz  |
+---------------------------------------------+
To download use `bosh download public stemcell <stemcell_name>'. For full url use --full.

$ bosh download public stemcell bosh-stemcell-XXXX-openstack-kvm-ubuntu.tgz
</pre>

<h3><a id="deploy"></a>Deploy Micro BOSH</h3>

<p>Set the Micro BOSH deployment file to use:</p>

<pre class="terminal">
cd ~/bosh-workspace/deployments
bosh micro deployment microbosh-openstack
</pre>

<p>This command will output:</p>
<pre class="highlight text">WARNING! Your target has been changed to `https://&lt;microbosh_ip_address&gt;:25555&#39;!
Deployment set to &#39;~/bosh-workspace/deployments/microbosh-openstack/micro_bosh.yml&#39;
</pre>
<p>Deploy the Micro BOSH:</p>

<pre class="terminal">
bosh micro deploy ~/bosh-workspace/stemcells/bosh-stemcell-XXXX-openstack-kvm-ubuntu.tgz
</pre>

<p>This command will output:</p>
<pre class="highlight text">Deploying new micro BOSH instance `microbosh-openstack/micro_bosh.yml&#39; to `https://&lt;microbosh_ip_address&gt;:25555&#39; (type &#39;yes&#39; to continue): yes

Verifying stemcell...
File exists and readable                                     OK
Manifest not found in cache, verifying tarball...
Read tarball                                                 OK
Manifest exists                                              OK
Stemcell image file                                          OK
Writing manifest to cache...
Stemcell properties                                          OK

Stemcell info
-------------
Name:    bosh-openstack-kvm-ubuntu
Version: 1029


Deploy Micro BOSH
  unpacking stemcell (00:00:02)
  uploading stemcell (00:00:35)
  creating VM from 04a1bdfe-4479-492e-8622-54380032a13a (00:01:21)
  waiting for the agent (00:01:20)
  create disk (00:00:05)
  mount disk (00:00:14)
  stopping agent services (00:00:01)
  applying micro BOSH spec (00:00:16)
  starting agent services (00:00:00)
  waiting for the director (00:00:15)
Done                    11/11 00:04:19
WARNING! Your target has been changed to `https://&lt;microbosh_ip_address&gt;:25555&#39;!
Deployment set to &#39;~/bosh-workspace/deployments/microbosh-openstack/micro_bosh.yml&#39;
Deployed `microbosh-openstack/micro_bosh.yml&#39; to `https://&lt;microbosh_ip_address&gt;:25555&#39;, took 00:04:19 to complete
</pre>
<h3><a id="troubleshooting"></a>Troubleshooting</h3>

<p>If for some reason the deploy process gets stucked or fails, you can check the log file located at <code>~/bosh-workspace/deployments/microbosh-openstack/bosh_micro_deploy.log</code>:</p>
<pre class="highlight text"># Logfile created on 2013-06-14 13:02:00 +0200 by logger.rb/31641
I, [2013-06-14T13:02:00.661999 #11533] [0x12b6ff0]  INFO -- : No existing deployments found (will save to /Users/frodenas/deployments/bosh-deployments.yml)
I, [2013-06-14T13:02:26.993498 #13692] [0x366ff0]  INFO -- : No existing deployments found (will save to /Users/frodenas/deployments/bosh-deployments.yml)
I, [2013-06-14T13:03:10.489924 #13692] [0x366ff0]  INFO -- : bosh_registry is ready on port 25889
I, [2013-06-14T13:03:13.135552 #13692] [0x366ff0]  INFO -- : Loading yaml from /tmp/d20130614-13692-15wkgqb/sc-20130614-13692-7eo4zq/stemcell.MF
I, [2013-06-14T13:03:19.602096 #13692] [create_stemcell(/tmp/d20130614-13692-15wkgqb/sc-20130614-13692-7eo4zq/image...)]  INFO -- : Creating new image...
I, [2013-06-14T13:03:19.602298 #13692] [create_stemcell(/tmp/d20130614-13692-15wkgqb/sc-20130614-13692-7eo4zq/image...)]  INFO -- : Extracting stemcell file to `/tmp/d20130614-13692-15wkgqb/d20130614-13692-2sfodm&#39;...

...

D, [2013-06-14T13:07:36.134753 #13692] [0x366ff0] DEBUG -- : Waiting for director to be ready: #&lt;Errno::ECONNREFUSED: Connection refused - connect(2) (https://&lt;microbosh_ip_address&gt;:25555)&gt;
I, [2013-06-14T13:07:36.171820 #13692] [0x366ff0]  INFO -- : Director is ready: {&quot;name&quot;=&gt;&quot;microbosh-openstack&quot;, &quot;uuid&quot;=&gt;&quot;fd581363-02cd-41c6-8bed-87780391cff7&quot;, &quot;version&quot;=&gt;&quot;1.5.0.pre.3 (release:bef17df0 bosh:bef17df0)&quot;, &quot;user&quot;=&gt;nil, &quot;cpi&quot;=&gt;&quot;openstack&quot;, &quot;features&quot;=&gt;{&quot;dns&quot;=&gt;
{&quot;status&quot;=&gt;true, &quot;extras&quot;=&gt;{&quot;domain_name&quot;=&gt;&quot;microbosh&quot;}}, &quot;compiled_package_cache&quot;=&gt;{&quot;status&quot;=&gt;false, &quot;extras&quot;=&gt;{&quot;provider&quot;=&gt;nil}}}
</pre>
<h2><a id="test_microbosh"></a>Testing your Micro BOSH</h2>

<h3><a id="microbosh_target"></a>Set target</h3>

<p>To set your Micro BOSH target use the <code>target</code> command:</p>

<pre class="terminal">
bosh target &lt;microbosh_ip_address&gt;
</pre>

<p>This command will ask for the admin credentials. Enter <code>admin</code> when prompted for both <code>username</code> and <code>password</code>.</p>
<pre class="highlight text">Target set to `microbosh-openstack&#39;
Your username: admin
Enter password: *****
Logged in as `admin&#39;
</pre>
<h3><a id="microbosh_create_user"></a>Create a new user</h3>

<p>To create a new user use the <code>create user</code> command:</p>

<pre class="terminal">
bosh create user
Enter new username: frodenas
Enter new password: ********
Verify new password: ********
User `frodenas' has been created
</pre>

<p>Then you can login with the new user credentials:</p>

<pre class="terminal">
bosh login
Your username: frodenas
Enter password: ********
Logged in as `frodenas'
</pre>

<p>The <code>admin</code> user will be deleted.</p>

<h3><a id="microbosh_status"></a>Check status</h3>

<p>To check the status of your Micro BOSH use the <code>status</code> command:</p>

<pre class="terminal">
bosh status
</pre>

<p>This command will output:</p>
<pre class="highlight text">Config
             /Users/frodenas/.bosh_config

Director
  Name       microbosh-openstack
  URL        https://&lt;microbosh_ip_address&gt;:25555
  Version    1.5.0.pre.3 (release:bef17df0 bosh:bef17df0)
  User       frodenas
  UUID       fd581363-02cd-41c6-8bed-87780391cff7
  CPI        openstack
  dns        enabled (domain_name: microbosh)
  compiled_package_cache disabled

Deployment
  not set
</pre>
<h3><a id="microbosh_ssh"></a>SSH</h3>

<p>You can ssh to your Micro BOSH vm using the private key set at the <a href="#cloud_properties">cloud properties</a> section of your Micro BOSH deployment file:</p>

<pre class="terminal">
ssh -i &lt;path_to_microbosh_keypar_private_key&gt; vcap@&lt;microbosh_ip_address&gt;
</pre>

<p>Then you can sudo to get root privileges (default password for root user is <code>c1oudc0w</code>). All BOSH data is located at <code>/var/vcap</code> directory.</p>

<p>If you want to change the default root password, add this section at the <a href="#manifest_file">manifest</a> file before deploying Micro BOSH:</p>
<pre class="highlight yaml"><span class="s">env</span><span class="p">:</span>
  <span class="s">bosh</span><span class="p">:</span>
    <span class="s">password</span><span class="p">:</span> <span class="s">&lt;hash_password&gt;</span>
</pre>
<ul>
<li><code>hash_password</code> <strong>must</strong> be a <a href="https://en.wikipedia.org/wiki/SHA-2">sha-512</a> hashed password (You can generate it using the <a href="https://www.mkpasswd.net/">mkpasswd</a> utility).</li>
</ul>

<h2><a id="delete_microbosh"></a>Deleting your Micro BOSH</h2>

<p>If you want to delete your Micro BOSH environment (vm, persistent disk and stemcell) use the <code>micro delete</code> command:</p>

<pre class="terminal">
cd ~/bosh-workspace/deployments
bosh micro delete
</pre>

<p>This command will output:</p>
<pre class="highlight text">You are going to delete micro BOSH deployment `microbosh-openstack&#39;.

THIS IS A VERY DESTRUCTIVE OPERATION AND IT CANNOT BE UNDONE!

Are you sure? (type &#39;yes&#39; to continue): yes

Delete micro BOSH
  stopping agent services (00:00:01)
  unmount disk (00:00:06)
  detach disk (00:00:06)
  delete disk (00:02:25)
  delete VM (00:00:10)
  delete stemcell (00:00:03)
Done                    7/7 00:02:53
Deleted deployment &#39;microbosh-openstack&#39;, took 00:02:53 to complete
</pre>
          </div><!-- End of content_inner -->
        </div><!-- End of container-full -->
      </div><!-- End of content -->
    </div><!-- End of non_footer -->
    <div id='footer'>
      <div id='container-footer'>
        <div class='bg_social'>
          <ul class='social'>
            <li>
            <a href='http://twitter.com/cloudfoundry' target='_blank'>
            <img alt='Twitter' src='/images/twitter_large.png'>
            </a>
            </li>
            <li>
            <a href='https://plus.google.com/114245065906861739918/posts' target='_blank'>
            <img alt='Google+' src='/images/g+_large.png'>
            </a>
            </li>
            <li>
            <a href='http://facebook.com/cloudfoundry' target='_blank'>
            <img alt='Facebook' src='/images/facebook_large.png'>
            </a>
            </li>
            <li>
            <a href='http://youtube.com/cloudfoundry' target='_blank'>
            <img alt='Youtube' src='/images/youtube_large.png'>
            </a>
            </li>
          </ul>
        </div><!-- End of bg_social -->
        <ul class='links'>
          <li>
          <a href='http://www.cloudfoundry.com/about'>About</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://blog.cloudfoundry.com/'>Blog</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://www.cloudfoundry.com/partners'>Partners</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://docs.cloudfoundry.com'>Docs</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://www.cloudfoundry.com/faq'>FAQ</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://status.cloudfoundry.com/'>Status</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://www.cloudfoundry.com/support'>Support</a>
          </li>
        </ul>
        <div class='copyright'>
          <div class='hr-horizontal-dark'></div>
          <br>
          <p>
            &copy;
            <script>
              //<![CDATA[
                var d = new Date();
                document.write(d.getFullYear());
              //]]>
            </script>
            GoPivotal, Inc. All rights reserved.
            <a href='http://www.cloudfoundry.com/terms'>Terms</a>
            <a href='http://www.gopivotal.com/privacy-policy' target='_blank'>Privacy</a>
          </p>
        </div><!-- End of copyright -->
      </div><!-- End of container-footer -->
    </div><!-- End of footer -->
    <script type="text/javascript">
      (function() {
        var didInit = false;
        function initMunchkin() {
          if(didInit === false) {
            didInit = true;
            Munchkin.init('625-IUJ-009');
          }
        }
        var s = document.createElement('script');
        s.type = 'text/javascript';
        s.async = true;
        s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
        s.onreadystatechange = function() {
          if (this.readyState == 'complete' || this.readyState == 'loaded') {
            initMunchkin();
          }
        };
        s.onload = initMunchkin;
        document.getElementsByTagName('head')[0].appendChild(s);
      })();
    </script>
  </body>
</html>
