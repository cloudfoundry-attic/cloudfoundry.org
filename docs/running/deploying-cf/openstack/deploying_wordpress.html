<!doctype html>
<html>
  <head>
    <meta charset="utf-8">

    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

    <!-- Use title if it's in the page YAML frontmatter -->
    <title>Deploying Wordpress using Micro BOSH</title>

    <link href="/stylesheets/master.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/style.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/all.js" type="text/javascript"></script>
    <link href='/images/favicon.ico' rel='shortcut icon'>
    <script type="text/javascript">
      $(document).ready(function(){
        $('a#search').click(function () {
          $('#organization_bar .navbar .nav>li a').css("padding","11px 20px 8px");
          $('#organization_bar .navbar .nav>li a#docs').css("padding","14px 20px");
          $('#organization_bar .navbar .nav>li a#search2').css("padding","11px 10px 8px");
          $('#search-on').show();
          $('#search-off').hide();
        });
        $('.cancel-x').click(function () {
          $('#organization_bar .navbar .nav>li a').css("padding","11px 63px 8px");
          $('#organization_bar .navbar .nav>li a#docs').css("padding","14px 20px");
          $('#organization_bar .navbar .nav>li a#search2, #organization_bar .navbar .nav>li a#search').css("padding","16px 20px 15px");
          $('#organization_bar .navbar .nav>li a#getinvolved').css("padding","11px 92px 8px");
          $('#organization_bar .navbar .nav>li#docs-off .docs-list-list a').css("padding","0");
          $('#search-on').hide();
          $('#search-off').show();
        });f
        $(".togglebutton").click(function () {
        var divname= this.value;
          $("#"+divname).show("slow").siblings().hide("slow");
        });
      });
    </script>

    <!--[if lt IE 9]>
    <style>
        #content .container-full {background:  #ebf0fa;}
        .call-to-contribute-box, .column-left, .column-middle, .column-right {background:#e3e8f2}
        #footer {background:#000;}
    </style>
    <![endif]-->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-22181585-1']);
      _gaq.push(['_setDomainName', 'cloudfoundry.com']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>

  <body class="docs docs_running docs_running_deploying-cf docs_running_deploying-cf_openstack docs_running_deploying-cf_openstack_deploying_wordpress">
    <img id="bg" src="/images/bg-plain-x.jpg">
    <div id='non_footer'>
      <div id='content'>
            <div class="text-center" style="background: url(/images/bg-crowd.png);background-position:center bottom;background-repeat:no-repeat">
                <img src="/images/logo_org.png">
            </div>
          <br></br>
        <div class='container-full'>
          <div id='organization_bar'>
            <div class='navbar'>
              <ul class='nav'>
                            <li id='icon-home-li'>
                                <a id='icon-home-link' href='/'>
                                    <img id='icon-home' src='http://blog.cloudfoundry.com/wp-content/static/cforg/img/icon-home.png'>
                                </a>
                            </li>
                            <li>
                                <a id='about' href='http://www.cloudfoundry.org/about.html'>About</a>
                            </li>
                            <li>
                                <a id='learn' href='http://www.cloudfoundry.org/learn.html'>Learn</a>
                            </li>
                            <li>
                                <a href='http://www.cloudfoundry.org/documentation.html'>Documentation</a>
                            </li>
                            <li>
                                <a id='get-involved' href='http://www.cloudfoundry.org/getinvolved.html'>Get Involved</a>
                            </li>

                <li id='docs-off'>
                    <!--
                  <a href='/' id='docs'>
                    <div id='icon-docs'></div>
                  </a>
                     -->
                  <div id='docs-list'>
                    <div class="docs-list-list">
                      <a class="docs-list-th" href='/docs/using/app-arch/'>Using Cloud Foundry</a>
                      <br>
                      <a href="/docs/using/app-arch/">Application Architecture Considerations</a>
                      <br>
                      <a href='/docs/using/deploying-apps/'>Deploying Apps</a>
                      <br>
                      <a href='/docs/using/managing-apps/'>Managing Apps</a>
                      <br>
                      <a href='/docs/using/services.html'>Using Services</a>
                      <br>
                      <a class="docs-list-see-all" href="/docs/using/">See all</a>
                    </div><!-- End of 1st column docs-list-list-->
                    <div class="hr-vertical"></div>
                    <div class="docs-list-list">
                      <a class="docs-list-th" href='/docs/running/'>Running Cloud Foundry</a>
                      <br>
                      <a href='/docs/running/architecture/'>Architecture</a>
                      <br>
                      <a href='/docs/running/bosh/'>BOSH</a>
                      <br>
                      <a href='/docs/running/deploying-cf/'>Deploying with BOSH</a>
                      <br>
                      <a href='/docs/running/deploying-cf-with-chef/'>Deploying with Chef</a>
                      <br>
                      <a href='/docs/running/micro_cloud_foundry/'>Micro Cloud Foundry</a>
                      <br>
                      <a href='/docs/running/managing-cf/index.html'>Managing Cloud Foundry</a>
                      <br>
                      <a class="docs-list-see-all" href="/docs/running/">See all</a>
                    </div><!-- End of column 2 docs-list-list -->
                    <div class="hr-vertical"></div>
                    <div class="docs-list-list">
                      <a class="docs-list-th" href='/docs/reference/'>Reference</a>
                      <br>
                      <a href='/docs/reference/cc-api.html'>Cloud Foundry REST API</a>
                      <br>
                      <a class="docs-list-th" href='/docs/dotcom/'>CloudFoundry.com</a>
                      <br>
                      <a href='/docs/dotcom/integration/'>Technical Integration</a>
                      <br>
                      <a class="docs-list-th" href='/docs/community/'>Community</a>
                    </div><!-- End of column 3 docs-list-list -->
                  </div><!-- End of docs-list -->
                </li>
                  <!--
                <li id='search-off'>
                  <a id='search'>
                    <div class='icon-search'></div>
                  </a>
                </li>
                <li id='search-on'>
                  <a id='search2'>
                    <form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
                      <input autocomplete='off' class='search-input' id='search-query' name='q' onfocus="this.placeholder = ''" placeholder='' type='search' value=''>
                    </form>
                    <div class="cancel-x"></div>
                  </a>
                </li>
                  -->
              </ul>
            </div><!-- End of navbar -->
          </div><!-- End of organization_bar -->
          <div class='content_inner'>
            <a class="forkme" href="http://github.com/cloudfoundry/cf-docs" target="_blank">
              <img alt="Fork me on GitHub" src="/images/ribbon_forkme.png">
            </a>
            <form action='http://www.cloudfoundry.com/search' class='search-docs-form' method='get' onsubmit='return submitQuery()'>
              <input autocomplete='off' class='search-docs-input' id='search-query' name='q' onfocus="this.placeholder = 'more:docs '" placeholder='' type='search-docs' value='more:docs '>
            </form>
            <br clear="left">
            
              <div class="breadcrumbs">
                <ul>
                  <li>
                    <a href="/">Home</a>
                  </li>
                  <li class=""><a href="/docs/running/">Running Cloud Foundry</a></li> <li class=""><a href="/docs/running/deploying-cf/">Deploying Cloud Foundry with BOSH</a></li> <li class=""><a href="/docs/running/deploying-cf/openstack/">Deploying Cloud Foundry on OpenStack</a></li> <li class="active"><span>Deploying Wordpress using Micro BOSH</span></li>
                </ul>
              </div>
              <br clear="left">

			

              <div class="quick-links"><ul>
<li><a href="#prerequisites">Prerequisites</a>

<ul>
<li><a href="#microbosh">Micro BOSH</a></li>
<li><a href="#stemcell">BOSH Stemcell</a></li>
<li><a href="#openstack_security_groups">OpenStack Security Groups</a></li>
<li><a href="#openstack_floating_ip">OpenStack Floating IPs</a></li>
</ul></li>
<li><a href="#deploy_wordpress">Deploying Wordpress</a>

<ul>
<li><a href="#upload_release">Upload Wordpress Release</a></li>
<li><a href="#manifest_file">Create manifest file</a></li>
<li><a href="#deploy">Deploy Wordpress</a></li>
</ul></li>
<li><a href="#delete_bosh">Deleting Wordpress</a></li>
</ul>
</div>

              <h1>Deploying Wordpress using Micro BOSH</h1>

            
            <p>This guide describes the process for deploying <a href="http://wordpress.org/">Wordpress</a> as an application using Micro BOSH.</p>

<h2><a id="prerequisites"></a>Prerequisites</h2>

<h3><a id="microbosh"></a>Micro BOSH</h3>

<p>Micro BOSH should be deployed and targeted. See the steps in <a href="/docs/running/deploying-cf/openstack/deploying_microbosh.html">Deploying Micro BOSH</a>.</p>

<h3><a id="stemcell"></a>BOSH Stemcell</h3>

<p>A BOSH Stemcell should be uploaded to the Micro BOSH. See the steps in <a href="/docs/running/deploying-cf/openstack/uploading_bosh_stemcell.html">Uploading a BOSH Stemcell</a>.</p>

<h3><a id="openstack_security_groups"></a>OpenStack Security Groups</h3>

<p>Create a new OpenStack security group, name it ie <code>wordpress</code>, and open the following ports:</p>

<ul>
<li>All ports (from <code>1</code> to <code>65535</code>) where the source group is the current security group</li>
<li>Port <code>80</code> from source 0.0.0.0/0 (CIDR): Used by Wordpress webserver</li>
</ul>

<h3><a id="openstack_floating_ip"></a>OpenStack Floating IPs</h3>

<p>Allocate a new OpenStack Floating IP to your project. We will use it to access our Wordpress application from outside of our network.</p>

<h2><a id="deploy_wordpress"></a>Deploying Wordpress</h2>

<h3><a id="upload_release"></a>Upload Wordpress Release</h3>

<p>Download the <a href="https://github.com/cloudfoundry/bosh-sample-release">BOSH sample release</a>:</p>

<pre class="terminal">
mkdir -p ~/bosh-workspace/releases
cd ~/bosh-workspace/releases
git clone git://github.com/cloudfoundry/bosh-sample-release.git
</pre>

<p>Upload the BOSH sample release to the Micro BOSH Director:</p>

<pre class="terminal">
cd ~/bosh-workspace/releases/bosh-sample-release
bosh upload release ~/bosh-workspace/releases/bosh-sample-release/releases/wordpress-2.yml
</pre>

<p>This command will output:</p>
<pre class="highlight text">Copying packages
----------------

...

Release has been created
  wordpress/2 (00:00:00)
Done                    1/1 00:00:00

Task 6 done
Started     2013-06-18 12:20:12 UTC
Finished    2013-06-18 12:20:14 UTC
Duration    00:00:02

Release uploaded
</pre>
<p>To confirm that the BOSH sample release has been loaded into your BOSH Director use the <code>bosh releases</code> command:</p>
<pre class="highlight text">+-----------+----------+-------------+
| Name      | Versions | Commit Hash |
+-----------+----------+-------------+
| wordpress | 2        | unknown     |
+-----------+----------+-------------+
(+) Uncommitted changes

Releases total: 1
</pre>
<h3><a id="manifest_file"></a>Create manifest file</h3>

<p>Using the <code>deployments</code> directory we created when we <a href="/docs/running/deploying-cf/openstack/deploying_microbosh.html#manifest_file">deployed Micro BOSH</a>, create a <code>wordpress-openstack</code> subdirectory:</p>

<pre class="terminal">
mkdir -p ~/bosh-workspace/deployments/wordpress-openstack
cd ~/bosh-workspace/deployments/wordpress-openstack
</pre>

<p>If you are using nova-network, copy the <code>dynamic</code> Wordpress example manifest file:</p>

<pre class="terminal">
cp ~/bosh-workspace/releases/bosh-sample-release/examples/wordpress-openstack-dynamic.yml wordpress-openstack.yml
</pre>

<p>If you are using the new <a href="http://www.openstack.org/software/openstack-networking/">OpenStack Networking</a> service, copy the <code>manual</code> Wordpress example manifest file:</p>

<pre class="terminal">
cp ~/bosh-workspace/releases/bosh-sample-release/examples/wordpress-openstack-manual.yml wordpress-openstack.yml
</pre>

<p>Adapt the <code>wordpress-openstack.yml</code> file to your environment settings. Search for the tag <code># CHANGE</code>:</p>

<ul>
<li>The <code>director_uuid</code> option set the <a href="/docs/running/bosh/components/director.html">Bosh Director</a> to use. We will use the Micro Bosh Director UUID. You can get it running the command <code>bosh status</code>.</li>
<li>The <code>instance_type</code> option set the OpenStack flavor used for the compilation vms (at the <code>compilation</code> section) and jobs vms (at the <code>resource_pools</code> section). The <code>flavor_name</code> <strong>must</strong> have ephemeral disk (check the <a href="/docs/running/deploying-cf/openstack/validate_openstack.html#ephemeral">validate your OpenStack</a> guide).</li>
<li>The <code>security_groups</code> option set the security groups used by vms, and <strong>must</strong> be existing security groups. We will use the <code>microbosh_security_group</code> we created when we <a href="/docs/running/deploying-cf/openstack/deploying_microbosh.html#openstack_security_groups">deployed Micro Bosh</a> and the <code>wordpress_security_group</code> we created <a href="#openstack_security_groups">previously</a>.</li>
<li>The <code>allocated_floating_ip</code> allows us to associate a floating IP adress to the Wordpress webserver and <strong>must</strong> be a previously allocated floating ip (check the <a href="#openstack_floating_ip">prerequisites</a> section).</li>
</ul>

<p>If you are using the new <a href="http://www.openstack.org/software/openstack-networking/">OpenStack Networking</a> component, you must also adapt the below settings:</p>

<ul>
<li>The <code>range</code> option sets the IP range to use. <code>subnet_cidr</code> <strong>must</strong> be a <a href="http://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing">CIDR</a> belonging to one of the network subnets set in <code>net_id</code>.</li>
<li>The <code>gateway</code> option sets subnet gateway.</li>
<li>The <code>reserved</code> option sets the range of IP addresses (starting at <code>first_reserved_ip_address</code> and ending at <code>last_reserved_ip_address</code>) that are reserved (so BOSH/OpenStack will not use them when assigning dynamically IP to vms).</li>
<li>The <code>static</code> option sets range of IP addresses (starting at <code>first_ip_address_for_vms</code> and ending at <code>last_ip_address_for_vms</code>) that are reserved to be set statically at the jobs section (so BOSH/OpenStack will not use them when assigning dynamically IP to vms).</li>
<li>The <code>net_id</code> option sets the OpenStack network to use. <code>network_uuid</code> <strong>must</strong> be an existing Network UUID (you can list your OpenStack networks using the command <code>quantum net-list</code>).</li>
<li>The <code>network</code> option at the <code>nfs_server</code> properties set the NFS clients allowed to access to the NFS server. In order to simplify the example we will use the <code>subnet_cidr</code> set previously, but we can use any <a href="http://manpages.ubuntu.com/manpages/lucid/man5/exports.5.html">Machine Name Format</a>.</li>
<li>The <code>ip_address_for_mysql</code>, <code>ip_address_for_nfs</code>, <code>ip_address_for_wordpress</code> and <code>ip_address_for_nginx</code> sets the IP address to assign to each job. These IP addresses <strong>must</strong> in the range of IP addresses set previously in the  <code>static</code> option.</li>
</ul>

<h3><a id="deploy"></a>Deploy Wordpress</h3>

<p>Set the Wordpress deployment file to use:</p>

<pre class="terminal">
bosh deployment ~/bosh-workspace/deployments/wordpress-openstack/wordpress-openstack.yml
</pre>

<p>This command will output:</p>
<pre class="highlight text">Deployment set to `/Users/frodenas/bosh-workspace/deployments/wordpress-openstack/wordpress-openstack.yml&#39;
</pre>
<p>Now deploy Wordpress:</p>

<pre class="terminal">
bosh deploy
</pre>

<p>This command will output:</p>
<pre class="highlight text">Getting deployment properties from director...
Unable to get properties list from director, trying without it...
Compiling deployment manifest...
Cannot get current deployment information from director, possibly a new deployment
Please review all changes carefully
Deploying `wordpress-openstack.yml&#39; to `microbosh-openstack&#39; (type &#39;yes&#39; to continue): yes

Director task 7

Preparing deployment
  binding deployment (00:00:00)
  binding releases (00:00:00)
  binding existing deployment (00:00:00)
  binding resource pools (00:00:00)
  binding stemcells (00:00:00)
  binding templates (00:00:00)
  binding properties (00:00:00)
  binding unallocated VMs (00:00:00)
  binding instance networks (00:00:00)
Done                    9/9 00:00:00

Preparing package compilation

Compiling packages
  wordpress/1 (00:02:28)
  nginx/1 (00:03:52)
  debian_nfs_server/1 (00:00:04)
  common/1 (00:00:05)
  mysql/1 (00:00:21)
  mysqlclient/1 (00:00:06)
  apache2/1 (00:03:12)
  php5/1 (00:04:16)
Done                    8/8 00:09:56

Preparing DNS
  binding DNS (00:00:00)
Done                    1/1 00:00:00

Creating bound missing VMs
  common/0 (00:02:57)
  common/2 (00:03:57)
  common/1 (00:03:59)
  common/3 (00:01:51)
Done                    4/4 00:04:48

Binding instance VMs
  nfs/0 (00:00:01)
  mysql/0 (00:00:01)
  wordpress/0 (00:00:01)
  nginx/0 (00:00:01)
Done                    4/4 00:00:02

Preparing configuration
  binding configuration (00:00:00)
Done                    1/1 00:00:00

Updating job mysql
  mysql/0 (canary) (00:00:42)
Done                    1/1 00:00:42

Updating job nfs
  nfs/0 (canary) (00:00:30)
Done                    1/1 00:00:30

Updating job wordpress
  wordpress/0 (canary) (00:01:47)
Done                    1/1 00:01:47

Updating job nginx
  nginx/0 (canary) (00:00:27)
Done                    1/1 00:00:27

Task 7 done
Started     2013-06-18 17:56:16 UTC
Finished    2013-06-18 18:14:55 UTC
Duration    00:18:39

Deployed `wordpress-openstack.yml&#39; to `microbosh-openstack&#39;
</pre>
<p>To confirm that the Wordpress has been deployed use the <code>bosh deployments</code> command:</p>
<pre class="highlight text">+---------------------+-------------+--------------------------------+
| Name                | Release(s)  | Stemcell(s)                    |
+---------------------+-------------+--------------------------------+
| wordpress-openstack | wordpress/2 | bosh-openstack-kvm-ubuntu/1029 |
+---------------------+-------------+--------------------------------+

Deployments total: 1
</pre>
<p>You can also check the jobs deployed and their state using the <code>bosh vms</code> command:</p>
<pre class="highlight text">Director task 8

Task 8 done

+-------------+---------+---------------+-------------------------------------------------+
| Job/index   | State   | Resource Pool | IPs                                             |
+-------------+---------+---------------+-------------------------------------------------+
| mysql/0     | running | common        | &lt;ip_address_for_mysql&gt;                          |
| nfs/0       | running | common        | &lt;ip_address_for_nfs&gt;                            |
| nginx/0     | running | common        | &lt;ip_address_for_nginx&gt;, &lt;allocated_floating_ip&gt; |
| wordpress/0 | running | common        | &lt;ip_address_for_wordpress&gt;                      |
+-------------+---------+---------------+-------------------------------------------------+

VMs total: 4
</pre>
<h2><a id="delete_bosh"></a>Deleting Wordpress</h2>

<p>If you want to delete your Wordpress deployment, set first the Wordpress deployment file:</p>

<pre class="terminal">
bosh deployment ~/bosh-workspace/deployments/wordpress-openstack/wordpress-openstack.yml
</pre>

<p>Then use the <code>delete deployment</code> command:</p>

<pre class="terminal">
bosh delete deployment wordpress-openstack
</pre>

<p>This command will output:</p>
<pre class="highlight text">You are going to delete deployment `wordpress-openstack&#39;.

THIS IS A VERY DESTRUCTIVE OPERATION AND IT CANNOT BE UNDONE!

Are you sure? (type &#39;yes&#39; to continue): yes

Director task 9

Deleting instances
  mysql/0 (00:00:50)
  wordpress/0 (00:00:53)
  nfs/0 (00:00:55)
  nginx/0 (00:00:19)
Done                    4/4 00:01:09

Removing deployment artifacts
  detach stemcells (00:00:00)
  detaching releases (00:00:00)
Done                    3/3 00:00:00

Deleting properties
  delete DNS records (00:00:00)
  destroy deployment (00:00:00)
Done                    0/0 00:00:00

Task 9 done
Started     2013-06-18 18:17:02 UTC
Finished    2013-06-18 18:18:11 UTC
Duration    00:01:09

Deleted deployment `wordpress-openstack&#39;
</pre>
          </div><!-- End of content_inner -->
        </div><!-- End of container-full -->
      </div><!-- End of content -->
    </div><!-- End of non_footer -->
    <div id='footer'>
      <div id='container-footer'>
        <div class='bg_social'>
          <ul class='social'>
            <li>
            <a href='http://twitter.com/cloudfoundry' target='_blank'>
            <img alt='Twitter' src='/images/twitter_large.png'>
            </a>
            </li>
            <li>
            <a href='https://plus.google.com/114245065906861739918/posts' target='_blank'>
            <img alt='Google+' src='/images/g+_large.png'>
            </a>
            </li>
            <li>
            <a href='http://facebook.com/cloudfoundry' target='_blank'>
            <img alt='Facebook' src='/images/facebook_large.png'>
            </a>
            </li>
            <li>
            <a href='http://youtube.com/cloudfoundry' target='_blank'>
            <img alt='Youtube' src='/images/youtube_large.png'>
            </a>
            </li>
          </ul>
        </div><!-- End of bg_social -->
        <ul class='links'>
                <li>
                    <a href='http://www.cloudfoundry.org/about.html'>About</a>
                </li>
                <li class='disc'>•</li>
                <li>
                    <a href='http://www.cloudfoundry.org/blog.html'>Blog</a>
                </li>
                <li class='disc'>•</li>
                <li>
                    <a href='http://www.cloudfoundry.org/about.html'>Partners</a>
                </li>
                <li class='disc'>•</li>
                <li>
                    <a href='http://www.cloudfoundry.org/documentation.html'>Docs</a>
                </li>
                <li class='disc'>•</li>
                <li>
                    <a href='http://www.cloudfoundry.org/faq.html'>FAQ</a>
                </li>
                <li class='disc'>•</li>
                <li>
                    <a href='http://www.cloudfoundry.org/getinvolved.html'>Get Involved</a>
                </li>
        </ul>
        <div class='copyright'>
          <div class='hr-horizontal-dark'></div>
          <br>
          <p>
            &copy;
            <script>
              //<![CDATA[
                var d = new Date();
                document.write(d.getFullYear());
              //]]>
            </script>
            IBM
          </p>
        </div><!-- End of copyright -->
      </div><!-- End of container-footer -->
    </div><!-- End of footer -->
    <script type="text/javascript">
      (function() {
        var didInit = false;
        function initMunchkin() {
          if(didInit === false) {
            didInit = true;
            Munchkin.init('625-IUJ-009');
          }
        }
        var s = document.createElement('script');
        s.type = 'text/javascript';
        s.async = true;
        s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
        s.onreadystatechange = function() {
          if (this.readyState == 'complete' || this.readyState == 'loaded') {
            initMunchkin();
          }
        };
        s.onload = initMunchkin;
        document.getElementsByTagName('head')[0].appendChild(s);
      })();
    </script>
  </body>
</html>
