<!doctype html>
<html>
  <head>
    <meta charset="utf-8">

    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

    <!-- Use title if it's in the page YAML frontmatter -->
    <title>Cloud Foundry Docs</title>

    <link href="/stylesheets/master.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/style.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/all.js" type="text/javascript"></script>
    <link href='/images/favicon.ico' rel='shortcut icon'>
    <script type="text/javascript">
      $(document).ready(function(){
        $('a#search').click(function () {
          $('#organization_bar .navbar .nav>li a').css("padding","11px 20px 8px");
          $('#organization_bar .navbar .nav>li a#docs').css("padding","14px 20px");
          $('#organization_bar .navbar .nav>li a#search2').css("padding","11px 10px 8px");
          $('#search-on').show();
          $('#search-off').hide();
        });
        $('.cancel-x').click(function () {
          $('#organization_bar .navbar .nav>li a').css("padding","11px 63px 8px");
          $('#organization_bar .navbar .nav>li a#docs').css("padding","14px 20px");
          $('#organization_bar .navbar .nav>li a#search2, #organization_bar .navbar .nav>li a#search').css("padding","16px 20px 15px");
          $('#organization_bar .navbar .nav>li a#getinvolved').css("padding","11px 92px 8px");
          $('#organization_bar .navbar .nav>li#docs-off .docs-list-list a').css("padding","0");
          $('#search-on').hide();
          $('#search-off').show();
        });f
        $(".togglebutton").click(function () {
        var divname= this.value;
          $("#"+divname).show("slow").siblings().hide("slow");
        });
      });
    </script>

    <!--[if lt IE 9]>
    <style>
        #content .container-full {background:  #ebf0fa;}
        .call-to-contribute-box, .column-left, .column-middle, .column-right {background:#e3e8f2}
        #footer {background:#000;}
    </style>
    <![endif]-->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-22181585-1']);
      _gaq.push(['_setDomainName', 'cloudfoundry.com']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>

  <body class="docs docs_running docs_running_deploying-cf docs_running_deploying-cf_vcloud docs_running_deploying-cf_vcloud_deploying_to_vcloud_director">
    <img id="bg" src="/images/bg-plain-x.jpg">
    <div id='non_footer'>
      <div id='header'>
        <div class='container_wide'>
          <ul class='actions'>
            <li class='last'>
              <a href="http://www.cloudfoundry.com/contact">Contact Us</a>
            </li>
            <li>
              <a class='register_link' href='http://login.run.pivotal.io/login'>My Account</a>            
            </li>
          </ul>
        </div>
      </div>
      <div id='content'>
        <div class='logo-main'>
          <div class='logo'>
            <a href='http://www.cloudfoundry.com'>
            <img src='/images/logo-cloudfoundry.png'>
            </a>
            <a href='http://www.gopivotal.com' target="_blank">
            <img id="pivotal-logo" src='/images/logo-pivotal.png'>
            </a>
          </div>
          <div class='cta'>
            <a href='https://console.run.pivotal.io'>
            <img src='/images/signup_freetrial.png'>
            </a>
          </div>
        </div><!-- End of logo-main-->
        <div class='container-full'>
          <div id='organization_bar'>
            <div class='navbar'>
              <ul class='nav'>
                <li>
                <a href='http://www.cloudfoundry.com/use' id='use'>Using Cloud Foundry</a>
                </li>
                <li>
                <a href='http://www.cloudfoundry.com/run' id='run'>Running Cloud Foundry</a>
                </li>
                <li>
                <a href='http://www.cloudfoundry.com/getinvolved' id='getinvolved'>Get Involved</a>
                </li>
                <li id='docs-off'>
                  <a href='/' id='docs'>
                    <div id='icon-docs'></div>
                  </a>
                  <div id='docs-list'>
                    <div class="docs-list-list">
                      <a class="docs-list-th" href='/docs/using/app-arch/'>Using Cloud Foundry</a>
                      <br>
                      <a href="/docs/using/app-arch/">Application Architecture Considerations</a>
                      <br>
                      <a href='/docs/using/deploying-apps/'>Deploying Apps</a>
                      <br>
                      <a href='/docs/using/managing-apps/'>Managing Apps</a>
                      <br>
                      <a href='/docs/using/services.html'>Using Services</a>
                      <br>
                      <a class="docs-list-see-all" href="/docs/using/">See all</a>
                    </div><!-- End of 1st column docs-list-list-->
                    <div class="hr-vertical"></div>
                    <div class="docs-list-list">
                      <a class="docs-list-th" href='/docs/running/'>Running Cloud Foundry</a>
                      <br>
                      <a href='/docs/running/architecture/'>Architecture</a>
                      <br>
                      <a href='/docs/running/bosh/'>BOSH</a>
                      <br>
                      <a href='/docs/running/deploying-cf/'>Deploying with BOSH</a>
                      <br>
                      <a href='/docs/running/deploying-cf-with-chef/'>Deploying with Chef</a>
                      <br>
                      <a href='/docs/running/micro_cloud_foundry/'>Micro Cloud Foundry</a>
                      <br>
                      <a href='/docs/running/managing-cf/index.html'>Managing Cloud Foundry</a>
                      <br>
                      <a class="docs-list-see-all" href="/docs/running/">See all</a>
                    </div><!-- End of column 2 docs-list-list -->
                    <div class="hr-vertical"></div>
                    <div class="docs-list-list">
                      <a class="docs-list-th" href='/docs/reference/'>Reference</a>
                      <br>
                      <a href='/docs/reference/cc-api.html'>Cloud Foundry REST API</a>
                      <br>
                      <a class="docs-list-th" href='/docs/dotcom/'>CloudFoundry.com</a>
                      <br>
                      <a href='/docs/dotcom/integration/'>Technical Integration</a>
                      <br>
                      <a class="docs-list-th" href='/docs/community/'>Community</a>
                    </div><!-- End of column 3 docs-list-list -->
                  </div><!-- End of docs-list -->
                </li>
                <li id='search-off'>
                  <a id='search'>
                    <div class='icon-search'></div>
                  </a>
                </li>
                <li id='search-on'>
                  <a id='search2'>
                    <form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
                      <input autocomplete='off' class='search-input' id='search-query' name='q' onfocus="this.placeholder = ''" placeholder='' type='search' value=''>
                    </form>
                    <div class="cancel-x"></div>
                  </a>
                </li>
              </ul>
            </div><!-- End of navbar -->
          </div><!-- End of organization_bar -->
          <div class='content_inner'>
            <a class="forkme" href="http://github.com/cloudfoundry/cf-docs" target="_blank">
              <img alt="Fork me on GitHub" src="/images/ribbon_forkme.png">
            </a>
            <form action='http://www.cloudfoundry.com/search' class='search-docs-form' method='get' onsubmit='return submitQuery()'>
              <input autocomplete='off' class='search-docs-input' id='search-query' name='q' onfocus="this.placeholder = 'more:docs '" placeholder='' type='search-docs' value='more:docs '>
            </form>
            <br clear="left">
            
              <div class="breadcrumbs">
                <ul>
                  <li>
                    <a href="/">Home</a>
                  </li>
                  <li class=""><a href="/docs/running/">Running Cloud Foundry</a></li> <li class=""><a href="/docs/running/deploying-cf/">Deploying Cloud Foundry with BOSH</a></li> <li class=""><a href="/docs/running/deploying-cf/vcloud/">Deploying Cloud Foundry on vCloud Director</a></li> <li class="active"><span></span></li>
                </ul>
              </div>
              <br clear="left">

			

              <div class="quick-links"></div>

              <h1></h1>

            
            <h1>Deploying to vCloud Director Using Cloud Foundry BOSH</h1>

<p>In this tutorial we learn how to deploy a simple Wordpress application on vCloud Director using BOSH.</p>

<h2>Prerequisites</h2>

<p>To get started with BOSH on vCloud you need:</p>

<ol>
<li>An account in a <a href="http://pubs.vmware.com/vcd-51/topic/com.vmware.vcloud.users.doc_51/GUID-B2D21D95-B37F-4339-9887-F7788D397FD8.html">vCloud organization</a> with <a href="http://pubs.vmware.com/vcd-51/topic/com.vmware.vcloud.users.doc_51/GUID-5B60A9C0-612A-4A3A-9ECE-694C40272505.html">organization administrator</a> credentials</li>
<li>A vCloud virtual datacenter with an Internet routable network and a block of assigned IP addresses</li>
<li>A Mac or *NIX computer</li>
<li>The <a href="/docs/running/bosh/setup/">BOSH CLI</a></li>
</ol>

<h2>Installing the BOSH Deployer</h2>

<p>We assume you already have Ruby (1.9.2) and rubygems (1.8) installed. To install the BOSH deployer gem (which includes the BOSH CLI):</p>
<pre class="highlight text">gem install bosh_deployer
</pre>
<h2>Micro BOSH Stemcells</h2>

<ul>
<li>We have published micro BOSH stemcells for download. When you are ready to use the BOSH deployer download a micro BOSH stemcell.</li>
</ul>

<p>Download a micro BOSH stemcell with version &gt;= 0.8.0 (coming soon)  Use bosh-release version #11 or higher.</p>

<p>Note :  Stemcells for vSphere work for vCloud Director</p>
<pre class="highlight text">    % bosh public stemcells
    +---------------------------------------+--------------------------------------------------+
    | Name                                  | Tags                                             |
    +---------------------------------------+--------------------------------------------------+
    | bosh-stemcell-aws-0.6.4.tgz           | aws, stable                                      |
    | bosh-stemcell-vsphere-0.6.4.tgz       | vsphere, stable                                  |
    | bosh-stemcell-vsphere-0.6.7.tgz       | vsphere, stable                                  | 
    | micro-bosh-stemcell-aws-0.6.4.tgz     | aws, micro, stable                               |
    | micro-bosh-stemcell-vsphere-0.6.4.tgz | vsphere, micro, stable                           |
    +---------------------------------------+--------------------------------------------------+
</pre>
<p>To download use <code>bosh download public stemcell &lt;stemcell_name&gt;</code> as shown below</p>
<pre class="highlight text">% bosh download public stemcell micro-bosh-stemcell-0.8.0.tgz
</pre>
<h2>Deploying Micro BOSH</h2>

<p>To deploy Micro Bosh on vCloud you will need to prepare resources from the cloud infrastructure managed by vCloud for use by BOSH.</p>

<h2>Preparing vCloud virtual data center resources</h2>

<ul>
<li>Add a catalog where stemcells and media (ISOs) for BOSH will be stored.</li>
</ul>

<p><img alt="vcloud_catalog" src="/images/vcloud_catalog.png" /></p>

<ul>
<li>Add a network to the virtual datacenter.  Configure the network to be directly connected to the virtual datacenter external network.  Steps to <a href="http://pubs.vmware.com/vcd-51/topic/com.vmware.vcloud.admin.doc_51/GUID-E8A80C28-6C16-4E83-828C-0510DA3B00F8.html">Create an External Direct Organization vDC Network</a>.</li>
</ul>

<h2>Create the Directory Structure</h2>

<p>The BOSH deployer will deploy applications based on files in expected directory locations:</p>
<pre class="highlight text">mkdir ~/deployments
cd ~/deployments
mkdir vcloud
</pre>
<h2>Create Micro BOSH Config File</h2>

<p>Micro BOSH configurations are set in the <code>micro_bosh.yml</code>, which you need to create.</p>

<ul>
<li>Create <code>~/deployments/vcloud/micro_bosh.yml</code> using <a href="../micro_bosh-vcloud.yml">this template</a>.</li>
</ul>

<ol>
<li>Update the instance of <code>x.x.x.x</code> with one of the IPs from the block assigned to you. Change the other IP addresses <code>n.n.n.n</code>  to match your network’s netmask, gateway, DNS and NTP server addresses.</li>
<li>Under the vcds section, replace <code>v.v.v.v</code> with the address of the vCloud instance and enter your vCloud credentials.</li>
<li>Save the file</li>
</ol>

<h2>Deploying Micro BOSH</h2>

<p>Micro BOSH can now be deployed from your deployments directory.</p>

<ul>
<li><p>Make sure you are in your deployments directory:</p>
<pre class="highlight text">cd ~/deployments
</pre></li>
<li><p>Select the deployment you created:</p>
<pre class="highlight text">bosh micro deployment vcloud
</pre></li>
</ul>

<p>Note: don’t be concerned by seemingly inaccurate message WARNING! Your target has been changed to http://vcloud:25555!</p>

<ul>
<li><p>Start the deployment using the micro stemcell downloaded earlier:</p>
<pre class="highlight text">bosh micro deploy ~/stemcells/micro-bosh-stemcell-vsphere-0.8.0.tgz
</pre></li>
<li><p>Within 20 minutes your instance of micro BOSH will be deployed. After the ‘Done’ message appears, you have a running micro BOSH instance.</p></li>
<li><p>If your deployment failed for some reason use the following to clean up:</p>
<pre class="highlight text">bosh micro delete
</pre></li>
<li><p>Log in to the Micro BOSH:</p>
<pre class="highlight text">bosh login
</pre></li>
<li><p>Type the default account name is admin and the password is admin</p></li>
<li><p>Change the account name and password using the command below. Don’t say we didn’t tell you if someone deletes your deployment!</p>
<pre class="highlight text">bosh create user &lt;username&gt; &lt;password&gt;
</pre></li>
</ul>

<h2>Deploying an Application Using BOSH</h2>

<p>We have created a sample three-tier application (Nginx, Apache + PHP with WordPress, and MySQL) to demonstrate how you can use BOSH, and the next step is to deploy it using your newly created micro BOSH instance.</p>

<h2>Uploading the Sample Release</h2>

<p>The sample release is on Github for your cloning convenience:</p>

<ul>
<li><p>First make a git clone of the sample application release repository:</p>
<pre class="highlight text">cd ~
git clone git://github.com/cloudfoundry/bosh-sample-release.git
cd bosh-sample-release
</pre></li>
<li><p>Upload the release to micro BOSH:</p>
<pre class="highlight text">bosh upload releases/wordpress-1.yml
</pre></li>
</ul>

<h2>Uploading the Latest Stem Cell</h2>

<p>Now we download the latest stem cellto upload to our micro BOSH instance.</p>

<ul>
<li><p>Download the latest BOSH stem cell for vCloud:</p>
<pre class="highlight text">bosh download public stemcell bosh-stemcell-vsphere-0.6.7.tgz
</pre></li>
<li><p>Upload it to your micro BOSH instance:</p>
<pre class="highlight text">bosh upload stemcell bosh-stemcell-vsphere-0.6.7.tgz
</pre></li>
</ul>

<h2>Create a Private Network</h2>

<ol>
<li><p><a href="http://pubs.vmware.com/vcd-51/index.jsp?topic=%2Fcom.vmware.vcloud.admin.doc_51%2FGUID-6E69AF88-31E0-4DD8-A79E-E8E4B6F68878.html">Add private networks</a> to separate application components from each other and from direct access by users. Here, “cf-net” is a direct network added earlier and “cf-routed” is a private network.
<img alt="vcloud_private_network" src="/images/vcloud_private_network.png" /></p></li>
<li><p>To allow machines on the private network to talk outside the network, e.g. the micro BOSH, <a href="http://www.google.com/url?q=http%3A%2F%2Fpubs.vmware.com%2Fvcd-51%2Findex.jsp%3Ftopic%3D%252Fcom.vmware.vcloud.admin.doc_51%252FGUID-464E27A8-3238-4553-ABCF-77808D3A510D.html&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNGXS8KPBo_PsbMblK3bh835u_FFmg">configure a source NAT rule on the network</a>.</p>

<p><img alt="vcloud_source_nat" src="/images/vcloud_source_nat.png" /></p></li>
</ol>

<h2>Create a Deployment Manifest</h2>

<ol>
<li><p>Get the director UUID using the following command:</p>
<pre class="highlight text">bosh status
</pre></li>
<li><p>Copy the file <a href="../wordpress-vcloud.yml">wordpress-vcloud.yml</a> in the bosh-sample-release directory and update it to suit your network.</p></li>
</ol>

<h2>Deploy</h2>

<ol>
<li><p>Select the deployment manifest you just created:</p>
<pre class="highlight text">bosh deployment ~/wordpress-vcloud.yml
</pre></li>
<li><p>Initiate the deployment:</p>
<pre class="highlight text">bosh deploy
</pre></li>
<li><p>Sit back and enjoy the show!</p></li>
</ol>

<h2>Connect to the deployed sample application</h2>

<p>Once your deployment is complete point your browser to the IP of the vm where nginx job is running <code>http://&lt;nginx-vm-staticip&gt;</code>.</p>

<p>Congratulations. You just used BOSH to deploy an application to vCloud!</p>

          </div><!-- End of content_inner -->
        </div><!-- End of container-full -->
      </div><!-- End of content -->
    </div><!-- End of non_footer -->
    <div id='footer'>
      <div id='container-footer'>
        <div class='bg_social'>
          <ul class='social'>
            <li>
            <a href='http://twitter.com/cloudfoundry' target='_blank'>
            <img alt='Twitter' src='/images/twitter_large.png'>
            </a>
            </li>
            <li>
            <a href='https://plus.google.com/114245065906861739918/posts' target='_blank'>
            <img alt='Google+' src='/images/g+_large.png'>
            </a>
            </li>
            <li>
            <a href='http://facebook.com/cloudfoundry' target='_blank'>
            <img alt='Facebook' src='/images/facebook_large.png'>
            </a>
            </li>
            <li>
            <a href='http://youtube.com/cloudfoundry' target='_blank'>
            <img alt='Youtube' src='/images/youtube_large.png'>
            </a>
            </li>
          </ul>
        </div><!-- End of bg_social -->
        <ul class='links'>
          <li>
          <a href='http://www.cloudfoundry.com/about'>About</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://blog.cloudfoundry.com/'>Blog</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://www.cloudfoundry.com/partners'>Partners</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://docs.cloudfoundry.com'>Docs</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://www.cloudfoundry.com/faq'>FAQ</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://status.cloudfoundry.com/'>Status</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://www.cloudfoundry.com/support'>Support</a>
          </li>
        </ul>
        <div class='copyright'>
          <div class='hr-horizontal-dark'></div>
          <br>
          <p>
            &copy;
            <script>
              //<![CDATA[
                var d = new Date();
                document.write(d.getFullYear());
              //]]>
            </script>
            GoPivotal, Inc. All rights reserved.
            <a href='http://www.cloudfoundry.com/terms'>Terms</a>
            <a href='http://www.gopivotal.com/privacy-policy' target='_blank'>Privacy</a>
          </p>
        </div><!-- End of copyright -->
      </div><!-- End of container-footer -->
    </div><!-- End of footer -->
    <script type="text/javascript">
      (function() {
        var didInit = false;
        function initMunchkin() {
          if(didInit === false) {
            didInit = true;
            Munchkin.init('625-IUJ-009');
          }
        }
        var s = document.createElement('script');
        s.type = 'text/javascript';
        s.async = true;
        s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
        s.onreadystatechange = function() {
          if (this.readyState == 'complete' || this.readyState == 'loaded') {
            initMunchkin();
          }
        };
        s.onload = initMunchkin;
        document.getElementsByTagName('head')[0].appendChild(s);
      })();
    </script>
  </body>
</html>
