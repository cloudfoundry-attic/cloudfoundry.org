<!doctype html>
<html>
  <head>
    <meta charset="utf-8">

    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

    <!-- Use title if it's in the page YAML frontmatter -->
    <title>CFoundry Ruby Gem</title>

    <link href="/stylesheets/master.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/style.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/all.js" type="text/javascript"></script>
    <link href='/images/favicon.ico' rel='shortcut icon'>
    <script type="text/javascript">
      $(document).ready(function(){
        $('a#search').click(function () {
          $('#organization_bar .navbar .nav>li a').css("padding","11px 20px 8px");
          $('#organization_bar .navbar .nav>li a#docs').css("padding","14px 20px");
          $('#organization_bar .navbar .nav>li a#search2').css("padding","11px 10px 8px");
          $('#search-on').show();
          $('#search-off').hide();
        });
        $('.cancel-x').click(function () {
          $('#organization_bar .navbar .nav>li a').css("padding","11px 63px 8px");
          $('#organization_bar .navbar .nav>li a#docs').css("padding","14px 20px");
          $('#organization_bar .navbar .nav>li a#search2, #organization_bar .navbar .nav>li a#search').css("padding","16px 20px 15px");
          $('#organization_bar .navbar .nav>li a#getinvolved').css("padding","11px 92px 8px");
          $('#organization_bar .navbar .nav>li#docs-off .docs-list-list a').css("padding","0");
          $('#search-on').hide();
          $('#search-off').show();
        });f
        $(".togglebutton").click(function () {
        var divname= this.value;
          $("#"+divname).show("slow").siblings().hide("slow");
        });
      });
    </script>

    <!--[if lt IE 9]>
    <style>
        #content .container-full {background:  #ebf0fa;}
        .call-to-contribute-box, .column-left, .column-middle, .column-right {background:#e3e8f2}
        #footer {background:#000;}
    </style>
    <![endif]-->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-22181585-1']);
      _gaq.push(['_setDomainName', 'cloudfoundry.com']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>

  <body class="docs docs_using docs_using_managing-apps docs_using_managing-apps_libs docs_using_managing-apps_libs_ruby-cfoundry">
    <img id="bg" src="/images/bg-plain-x.jpg">
    <div id='non_footer'>
      <div id='header'>
        <div class='container_wide'>
          <ul class='actions'>
            <li class='last'>
              <a href="http://www.cloudfoundry.com/contact">Contact Us</a>
            </li>
            <li>
              <a class='register_link' href='http://login.run.pivotal.io/login'>My Account</a>            
            </li>
          </ul>
        </div>
      </div>
      <div id='content'>
        <div class='logo-main'>
          <div class='logo'>
            <a href='http://www.cloudfoundry.com'>
            <img src='/images/logo-cloudfoundry.png'>
            </a>
            <a href='http://www.gopivotal.com' target="_blank">
            <img id="pivotal-logo" src='/images/logo-pivotal.png'>
            </a>
          </div>
          <div class='cta'>
            <a href='https://console.run.pivotal.io'>
            <img src='/images/signup_freetrial.png'>
            </a>
          </div>
        </div><!-- End of logo-main-->
        <div class='container-full'>
          <div id='organization_bar'>
            <div class='navbar'>
              <ul class='nav'>
                <li>
                <a href='http://www.cloudfoundry.com/use' id='use'>Using Cloud Foundry</a>
                </li>
                <li>
                <a href='http://www.cloudfoundry.com/run' id='run'>Running Cloud Foundry</a>
                </li>
                <li>
                <a href='http://www.cloudfoundry.com/getinvolved' id='getinvolved'>Get Involved</a>
                </li>
                <li id='docs-off'>
                  <a href='/' id='docs'>
                    <div id='icon-docs'></div>
                  </a>
                  <div id='docs-list'>
                    <div class="docs-list-list">
                      <a class="docs-list-th" href='/docs/using/app-arch/'>Using Cloud Foundry</a>
                      <br>
                      <a href="/docs/using/app-arch/">Application Architecture Considerations</a>
                      <br>
                      <a href='/docs/using/deploying-apps/'>Deploying Apps</a>
                      <br>
                      <a href='/docs/using/managing-apps/'>Managing Apps</a>
                      <br>
                      <a href='/docs/using/services.html'>Using Services</a>
                      <br>
                      <a class="docs-list-see-all" href="/docs/using/">See all</a>
                    </div><!-- End of 1st column docs-list-list-->
                    <div class="hr-vertical"></div>
                    <div class="docs-list-list">
                      <a class="docs-list-th" href='/docs/running/'>Running Cloud Foundry</a>
                      <br>
                      <a href='/docs/running/architecture/'>Architecture</a>
                      <br>
                      <a href='/docs/running/bosh/'>BOSH</a>
                      <br>
                      <a href='/docs/running/deploying-cf/'>Deploying with BOSH</a>
                      <br>
                      <a href='/docs/running/deploying-cf-with-chef/'>Deploying with Chef</a>
                      <br>
                      <a href='/docs/running/micro_cloud_foundry/'>Micro Cloud Foundry</a>
                      <br>
                      <a href='/docs/running/managing-cf/index.html'>Managing Cloud Foundry</a>
                      <br>
                      <a class="docs-list-see-all" href="/docs/running/">See all</a>
                    </div><!-- End of column 2 docs-list-list -->
                    <div class="hr-vertical"></div>
                    <div class="docs-list-list">
                      <a class="docs-list-th" href='/docs/reference/'>Reference</a>
                      <br>
                      <a href='/docs/reference/cc-api.html'>Cloud Foundry REST API</a>
                      <br>
                      <a class="docs-list-th" href='/docs/dotcom/'>CloudFoundry.com</a>
                      <br>
                      <a href='/docs/dotcom/integration/'>Technical Integration</a>
                      <br>
                      <a class="docs-list-th" href='/docs/community/'>Community</a>
                    </div><!-- End of column 3 docs-list-list -->
                  </div><!-- End of docs-list -->
                </li>
                <li id='search-off'>
                  <a id='search'>
                    <div class='icon-search'></div>
                  </a>
                </li>
                <li id='search-on'>
                  <a id='search2'>
                    <form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
                      <input autocomplete='off' class='search-input' id='search-query' name='q' onfocus="this.placeholder = ''" placeholder='' type='search' value=''>
                    </form>
                    <div class="cancel-x"></div>
                  </a>
                </li>
              </ul>
            </div><!-- End of navbar -->
          </div><!-- End of organization_bar -->
          <div class='content_inner'>
            <a class="forkme" href="http://github.com/cloudfoundry/cf-docs" target="_blank">
              <img alt="Fork me on GitHub" src="/images/ribbon_forkme.png">
            </a>
            <form action='http://www.cloudfoundry.com/search' class='search-docs-form' method='get' onsubmit='return submitQuery()'>
              <input autocomplete='off' class='search-docs-input' id='search-query' name='q' onfocus="this.placeholder = 'more:docs '" placeholder='' type='search-docs' value='more:docs '>
            </form>
            <br clear="left">
            
              <div class="breadcrumbs">
                <ul>
                  <li>
                    <a href="/">Home</a>
                  </li>
                  <li class=""><a href="/docs/using/">Using Cloud Foundry</a></li> <li class=""><a href="/docs/using/managing-apps/">Managing Apps, Orgs and Spaces</a></li> <li class=""><a href="/docs/using/managing-apps/libs/">API and Libraries</a></li> <li class="active"><span>CFoundry Ruby Gem</span></li>
                </ul>
              </div>
              <br clear="left">

			

              <div class="quick-links"><ul>
<li><a href="#intro">Introduction</a></li>
<li><a href="#connecting">Connecting to Cloud Foundry</a></li>
<li><a href="#persist-authentication">Persisting Authentication (Using cf tokens)</a></li>
<li><a href="#organisations">Organisations</a></li>
<li><a href="#spaces">Spaces</a></li>
<li><a href="#services">Services, Service Instances and Service Plans</a></li>
<li><a href="#runtimes-and-frameworks">Runtimes and Frameworks</a></li>
<li><a href="#applications">Applications</a></li>
<li><a href="#env-vars">Environment Variables</a></li>
<li><a href="#domains">Domains</a></li>
</ul>
</div>

              <h1>CFoundry Ruby Gem</h1>

            
            <h2><a id='intro'></a>Introduction</h2>

<p>This is a guide to using the CFoundry Ruby Gem to manage an account on a Cloud Foundry instance.</p>

<h2><a id='connecting'></a>Connecting to Cloud Foundry</h2>

<p>First of all, make sure to include the <code>cfoundry</code> gem as part of your application. Add it the application <code>Gemfile</code> if your are using Bundler;</p>
<pre class="highlight ruby">
<span class="n">source</span> <span class="s1">&#39;https://rubygems.org&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;cfoundry&#39;</span>

</pre>
<p>The first step to using cfoundry is creating a Client instance and logging in;</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">&#39;cfoundry&#39;</span>

<span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;http://api.cloudfoundry.com&#39;</span>
<span class="n">username</span> <span class="o">=</span> <span class="s1">&#39;my_cf_user&#39;</span>
<span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;my_cf_password&#39;</span>

<span class="n">client</span> <span class="o">=</span> <span class="no">CFoundry</span><span class="o">::</span><span class="no">Client</span><span class="nf">.new</span> <span class="n">endpoint</span>
<span class="n">client</span><span class="nf">.login</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span>
</pre>
<p>Test the connection by listing the available services;</p>
<pre class="highlight ruby">
<span class="n">client</span><span class="nf">.services.collect</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span><span class="nf">.description</span> <span class="p">}</span>

</pre>
<h2><a id='persist-authentication'></a>Persisting Authentication (Using cf tokens)</h2>

<p>A far safer way of creating a cfoundry client object without potentially exposing your credentials in source code is to login using cf and then use the generated auth token to login in. The auth tokens are stored by cf in ~/.cf/tokens.yml. The following snippet of ruby code shows how to open this file, select the right auth token and then use it to log in to Cloud Foundry.</p>
<pre class="highlight ruby">
<span class="nb">require</span> <span class="s1">&#39;cfoundry&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;yaml&#39;</span>

<span class="n">home</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;HOME&#39;</span><span class="o">]</span>
<span class="n">endpoint</span> <span class="o">=</span> <span class="s1">&#39;https://api.cloudfoundry.com&#39;</span>

<span class="n">config</span> <span class="o">=</span> <span class="no">YAML</span><span class="nf">.load</span> <span class="no">File</span><span class="nf">.read</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">home</span><span class="si">}</span><span class="s2">/.cf/tokens.yml&quot;</span><span class="p">)</span>
<span class="n">token</span> <span class="o">=</span> <span class="no">CFoundry</span><span class="o">::</span><span class="no">AuthToken</span><span class="nf">.from_hash</span> <span class="n">config</span><span class="o">[</span><span class="n">endpoint</span><span class="o">]</span>

<span class="n">client</span> <span class="o">=</span> <span class="no">CFoundry</span><span class="o">::</span><span class="no">Client</span><span class="nf">.new</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">token</span>

</pre>
<p>Once the client object is created, it can be used in the same fashion as before.</p>

<h2><a id='organisations'></a>Organisations</h2>

<p>An account will always belong to at least one organization. Inspect the organizations using the client class;</p>
<pre class="highlight ruby">
<span class="o">&gt;&gt;</span> <span class="n">client</span><span class="nf">.organizations</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="c1">#&lt;CFoundry::V2::Organization &#39;1e3ce9fb-50ac-4d2a-9506-f4d671c00f50&#39;&gt;, #&lt;CFoundry::V2::Organization &#39;77ab28ea-2b6e-4a7f-86c8-2c2df2714535&#39;&gt;]</span>

</pre>
<h2><a id='spaces'></a>Spaces</h2>

<p>Each organisation on Cloud Foundry can be separated in to spaces, we can easily inspect these via the client class;</p>
<pre class="highlight ruby">
<span class="o">&gt;&gt;</span> <span class="n">client</span><span class="nf">.spaces.collect</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span><span class="nf">.name</span> <span class="p">}</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="s2">&quot;development&quot;</span><span class="p">,</span> <span class="s2">&quot;staging&quot;</span><span class="p">,</span> <span class="s2">&quot;production&quot;</span><span class="o">]</span>

</pre>
<p>Creating and deleting a space is also straight forward;</p>
<pre class="highlight ruby">
<span class="c1"># create a space</span>
<span class="n">new_space</span> <span class="o">=</span> <span class="n">client</span><span class="nf">.space</span>
<span class="n">new_space</span><span class="nf">.name</span> <span class="o">=</span> <span class="s1">&#39;New Space&#39;</span>
<span class="n">new_space</span><span class="nf">.organization</span> <span class="o">=</span> <span class="n">client</span><span class="nf">.organizations.first</span>
<span class="n">new_space</span><span class="nf">.create!</span>

<span class="c1"># then, delete it</span>
<span class="n">new_space</span><span class="nf">.delete!</span>

</pre>
<p>There are several methods for retrieving a space;</p>
<pre class="highlight ruby">
<span class="c1"># find space by name</span>
<span class="n">client</span><span class="nf">.space_by_name</span> <span class="s1">&#39;development&#39;</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;CFoundry::V2::Space &#39;07b7271f-bcfa-47df-aa9b-3911c60a0d65&#39;&gt;</span>

<span class="n">client</span><span class="nf">.methods.grep</span> <span class="sr">/space_by/</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:spaces_by_name</span><span class="p">,</span> <span class="ss">:spaces_by_organization_guid</span><span class="p">,</span> <span class="ss">:spaces_by_developer_guid</span><span class="p">,</span> <span class="ss">:spaces_by_app_guid</span><span class="o">]</span>

</pre>
<h2><a id='services'></a>Services, Service Instances and Service Plans</h2>

<p>On Cloud Foundry each service has many service plans, depending on the instance, they will vary greatly. For the purposes of this document we will always use the first service plan for each service.</p>

<p>The Client class contains four service methods; services, service<em>instances, service</em>instance<em>by</em>name and service_instance.</p>

<p>The first method, &#39;services&#39;, returns a hash of all the available services on the targeted Cloud Foundry instance;</p>
<pre class="highlight ruby"><span class="n">client</span><span class="nf">.services.collect</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span><span class="nf">.description</span> <span class="p">}</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="s2">&quot;MySQL database&quot;</span><span class="p">,</span> <span class="s2">&quot;MongoDB NoSQL database&quot;</span><span class="p">,</span> <span class="s2">&quot;Redis key-value store&quot;</span><span class="p">,</span> <span class="s2">&quot;RabbitMQ message queue&quot;</span><span class="p">,</span> <span class="s2">&quot;PostgreSQL database (vFabric)&quot;</span><span class="o">]</span>
</pre>
<p>The &#39;service_instances&#39; method returns the actual service instances currently provisioned on that account;</p>
<pre class="highlight ruby"><span class="n">pp</span> <span class="n">client</span><span class="nf">.service_instances</span>
<span class="o">[</span><span class="c1">#&lt;CFoundry::V1::ServiceInstance &#39;mysql-7327e&#39;&gt;,</span>
 <span class="c1">#&lt;CFoundry::V1::ServiceInstance &#39;redis-6b10d&#39;&gt;,</span>
 <span class="c1">#&lt;CFoundry::V1::ServiceInstance &#39;mongodb-3894a&#39;&gt;,</span>
 <span class="c1">#&lt;CFoundry::V1::ServiceInstance &#39;postgresql-e7870&#39;&gt;,</span>
 <span class="c1">#&lt;CFoundry::V1::ServiceInstance &#39;mysql-adeb7&#39;&gt;,</span>
 <span class="nf">..</span><span class="o">.</span>
 <span class="c1">#&lt;CFoundry::V1::ServiceInstance &#39;mysql-13e8f&#39;&gt;,</span>
 <span class="c1">#&lt;CFoundry::V1::ServiceInstance &#39;mongodb-220c4&#39;&gt;]</span>
</pre>
<p>The &#39;service_instance_by_name&#39; method returns a named service instance;</p>
<pre class="highlight ruby"><span class="n">client</span><span class="nf">.service_instance_by_name</span> <span class="s1">&#39;mysql-7327e&#39;</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;CFoundry::V1::ServiceInstance &#39;mysql-7327e&#39;&gt;</span>
</pre>
<p>To create a service instance use the service_instance method;</p>
<pre class="highlight ruby">
<span class="n">service</span> <span class="o">=</span> <span class="n">client</span><span class="nf">.services.select</span><span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span><span class="nf">.label</span> <span class="o">==</span> <span class="s1">&#39;redis&#39;</span> <span class="p">}</span><span class="nf">.first</span> <span class="c1"># &lt;- find the service we wish to deploy</span>
<span class="n">service_plan</span> <span class="o">=</span> <span class="n">client</span><span class="nf">.service_plans_by_service_guid</span><span class="p">(</span><span class="n">service</span><span class="nf">.guid</span><span class="p">)</span><span class="nf">.first</span> <span class="c1"># &lt;- find the services first service plan</span>

<span class="n">service_instance</span> <span class="o">=</span> <span class="n">client</span><span class="nf">.service_instance</span> <span class="c1"># &lt;- prepare a new instance</span>
<span class="n">service_instance</span><span class="nf">.name</span> <span class="o">=</span> <span class="s1">&#39;my_new_redis_service&#39;</span> <span class="c1"># &lt;- give it a name</span>

<span class="n">service_instance</span><span class="nf">.service_plan</span> <span class="o">=</span> <span class="n">service_plan</span> <span class="c1"># &lt;- assign the plan</span>
<span class="n">service_instance</span><span class="nf">.space</span> <span class="o">=</span> <span class="n">client</span><span class="nf">.spaces.first</span> <span class="c1"># &lt;- assign the space the service instance will belong to</span>

<span class="n">service_instance</span><span class="nf">.create!</span> <span class="c1"># &lt;- send the request to create it</span>

<span class="c1"># if the create was succesful, it should return true.</span>

</pre>
<h2><a id='runtimes-and-frameworks'></a>Runtimes and Frameworks</h2>

<p>Both runtimes and frameworks have a collection that can be used to reference them both;</p>
<pre class="highlight ruby">
<span class="n">client</span><span class="nf">.frameworks.collect</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span><span class="nf">.name</span> <span class="p">}</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="s2">&quot;play&quot;</span><span class="p">,</span> <span class="s2">&quot;java_web&quot;</span><span class="p">,</span> <span class="s2">&quot;buildpack&quot;</span><span class="p">,</span> <span class="s2">&quot;lift&quot;</span><span class="p">,</span> <span class="s2">&quot;rails3&quot;</span><span class="p">,</span> <span class="s2">&quot;spring&quot;</span><span class="p">,</span> <span class="s2">&quot;grails&quot;</span><span class="p">,</span> <span class="s2">&quot;sinatra&quot;</span><span class="p">,</span> <span class="s2">&quot;rack&quot;</span><span class="p">,</span> <span class="s2">&quot;node&quot;</span><span class="p">,</span> <span class="s2">&quot;standalone&quot;</span><span class="o">]</span>

<span class="n">client</span><span class="nf">.runtimes.collect</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span><span class="nf">.name</span> <span class="p">}</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="s2">&quot;java&quot;</span><span class="p">,</span> <span class="s2">&quot;java7&quot;</span><span class="p">,</span> <span class="s2">&quot;node&quot;</span><span class="p">,</span> <span class="s2">&quot;node06&quot;</span><span class="p">,</span> <span class="s2">&quot;node08&quot;</span><span class="p">,</span> <span class="s2">&quot;ruby18&quot;</span><span class="p">,</span> <span class="s2">&quot;ruby19&quot;</span><span class="o">]</span>


</pre>
<h2><a id='applications'></a>Applications</h2>

<p>The Client class contains three application methods; apps, app and app<em>by</em>name</p>

<p>The &#39;apps&#39; method returns a list of all the deployed applications;</p>
<pre class="highlight ruby">
<span class="n">client</span><span class="nf">.apps</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="c1">#&lt;CFoundry::V2::App &#39;27edfb92-b0f4-47ad-acd6-cb911eb88096&#39;&gt;]</span>

</pre>
<p>The &#39;app_by_name&#39; method finds an application by it&#39;s name;</p>
<pre class="highlight ruby"><span class="n">client</span><span class="nf">.apps_by_name</span> <span class="s2">&quot;node_app&quot;</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="c1">#&lt;CFoundry::V2::App &#39;27edfb92-b0f4-47ad-acd6-cb911eb88096&#39;&gt;]</span>
</pre>
<p>To create an application user the app method;</p>
<pre class="highlight ruby">
<span class="n">app</span> <span class="o">=</span> <span class="n">client</span><span class="nf">.app</span>
<span class="n">app</span><span class="nf">.name</span> <span class="o">=</span> <span class="s1">&#39;my_new_app&#39;</span>
<span class="n">app</span><span class="nf">.total_instances</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># &lt;- set the number of instances you want</span>
<span class="n">app</span><span class="nf">.memory</span> <span class="o">=</span> <span class="mi">512</span> <span class="c1"># &lt;- set the allocated amount of memory</span>
<span class="n">app</span><span class="nf">.production</span> <span class="o">=</span> <span class="kp">true</span> <span class="c1"># &lt;- should the application run in production mode</span>
<span class="n">app</span><span class="nf">.framework</span> <span class="o">=</span> <span class="n">client</span><span class="nf">.frameworks.select</span><span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span><span class="nf">.name</span> <span class="o">==</span> <span class="s1">&#39;rails3&#39;</span> <span class="p">}</span><span class="nf">.first</span> <span class="c1"># &lt;- set the framework</span>
<span class="n">app</span><span class="nf">.runtime</span> <span class="o">=</span> <span class="n">client</span><span class="nf">.runtimes.select</span><span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span><span class="nf">.name</span> <span class="o">==</span> <span class="s1">&#39;ruby19&#39;</span> <span class="p">}</span><span class="nf">.first</span> <span class="c1"># &lt;- set the runtime</span>
<span class="n">app</span><span class="nf">.space</span> <span class="o">=</span> <span class="n">client</span><span class="nf">.spaces.first</span> <span class="c1"># &lt;- assign the application to a space</span>

<span class="n">app</span><span class="nf">.create!</span>

<span class="c1"># we may also want to bind a service too</span>
<span class="n">app</span><span class="nf">.bind</span> <span class="n">client</span><span class="nf">.service_instance_by_name</span><span class="p">(</span><span class="s1">&#39;my_new_redis_service&#39;</span><span class="p">)</span>

</pre>
<p>In order for the application to be accessible via http it has to be assigned a route on a domain;</p>
<pre class="highlight ruby"><span class="n">route</span> <span class="o">=</span> <span class="n">client</span><span class="nf">.route</span>
<span class="n">route</span><span class="nf">.domain</span> <span class="o">=</span> <span class="n">client</span><span class="nf">.domains.first</span> <span class="c1"># &lt;- pick the first / default route</span>
<span class="n">route</span><span class="nf">.space</span> <span class="o">=</span> <span class="n">space</span> <span class="c1"># &lt;- assign the route to a space</span>
<span class="n">route</span><span class="nf">.host</span> <span class="o">=</span> <span class="s1">&#39;my-rails-app&#39;</span> <span class="c1"># &lt;- this is the part of the url that is prepended to the domain</span>
<span class="n">route</span><span class="nf">.create!</span>

<span class="n">app</span><span class="nf">.add_route</span> <span class="n">route</span> <span class="c1"># &lt;- add the route to the domain</span>

</pre>
<p>This only creates an application &#39;stub&#39;, as of yet there is no actual code uploaded to Cloud Foundry nor is the application started. To give the application something to run and depending on the runtime and framework archive the source, byte code or binary in to a zip file. Upload the zipfile to the application but using the upload command;</p>
<pre class="highlight ruby">
<span class="nb">require</span> <span class="s1">&#39;zip/zip&#39;</span>

<span class="c1"># create an archive of the current folder</span>

<span class="no">Zip</span><span class="o">::</span><span class="no">ZipFile</span><span class="nf">.open</span><span class="p">(</span><span class="s1">&#39;app.zip&#39;</span><span class="p">,</span> <span class="no">Zip</span><span class="o">::</span><span class="no">ZipFile</span><span class="o">::</span><span class="no">CREATE</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">zipfile</span><span class="o">|</span>
  <span class="no">Dir</span><span class="nf">.glob</span><span class="p">(</span><span class="s1">&#39;**/*&#39;</span><span class="p">)</span><span class="nf">.each</span> <span class="k">do</span> <span class="o">|</span><span class="n">filename</span><span class="o">|</span>
    <span class="n">zipfile</span><span class="nf">.add</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="no">File</span><span class="nf">.join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">app</span><span class="nf">.upload</span> <span class="s1">&#39;app.zip&#39;</span>

</pre>
<p>Now the application has been uploaded to Cloud Foundry, all that is left is to start the application</p>
<pre class="highlight ruby"><span class="n">app</span><span class="nf">.start!</span>
</pre>
<p>The call to start is asynchronous, if true and a block is passed to the method then the block gets called with a URL. The url is the location of a real time log that can be requested via HTTP. CFoundry::Client has a method named stream_url which will transfer chunked data from the server;</p>
<pre class="highlight ruby">
<span class="n">app</span><span class="nf">.start!</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">url</span><span class="o">|</span>
  <span class="k">begin</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="kp">true</span>
      <span class="k">begin</span>
        <span class="n">client</span><span class="nf">.stream_url</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="s2">&quot;&amp;tail&amp;tail_offset=</span><span class="si">#{</span><span class="n">offset</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">out</span><span class="o">|</span>
          <span class="n">offset</span> <span class="o">+=</span> <span class="n">out</span><span class="nf">.size</span>
          <span class="nb">print</span> <span class="n">out</span>
        <span class="k">end</span>
      <span class="k">rescue</span> <span class="no">Timeout</span><span class="o">::</span><span class="no">Error</span>
      <span class="k">end</span>
    <span class="k">end</span>

  <span class="k">rescue</span> <span class="no">CFoundry</span><span class="o">::</span><span class="no">APIError</span>
  <span class="k">end</span>
<span class="k">end</span>

</pre>
<h2><a id='env-vars'></a>Environment Variables</h2>

<p>Modifying an applications environment variable is trivial;</p>
<pre class="highlight ruby">
<span class="n">app</span> <span class="o">=</span> <span class="n">client</span><span class="nf">.apps.first</span>

<span class="n">app</span><span class="nf">.env</span><span class="o">[</span><span class="s1">&#39;my_env_var&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;env_value&#39;</span> <span class="c1"># &lt;- set the environment variable</span>
<span class="n">app</span><span class="nf">.update!</span> <span class="c1"># &lt;- commit the change to the application</span>
<span class="o">=&gt;</span> <span class="kp">true</span>

<span class="n">app</span><span class="nf">.env</span><span class="o">[</span><span class="s1">&#39;my_env_var&#39;</span><span class="o">]</span> <span class="c1"># &lt;- retrieve the variable</span>
<span class="o">=&gt;</span> <span class="s2">&quot;env_value&quot;</span>

</pre>
<h2><a id='domains'></a>Domains</h2>

<p>Domains are the base on which routes are created. The default domain for a Cloud Foundry instance is the domain the Cloud Foundry instance is actually on.</p>

<p>To create a new domain use the &#39;domain&#39; method on the client class;</p>
<pre class="highlight ruby">
<span class="n">domain</span> <span class="o">=</span> <span class="n">client</span><span class="nf">.domain</span>
<span class="n">domain</span><span class="nf">.name</span> <span class="o">=</span> <span class="s1">&#39;mydomain.com&#39;</span> <span class="c1"># &lt;- the name of the domain</span>
<span class="n">domain</span><span class="nf">.wildcard</span> <span class="o">=</span> <span class="kp">true</span>
<span class="n">domain</span><span class="nf">.owning_organization</span> <span class="o">=</span> <span class="n">client</span><span class="nf">.organizations.first</span> <span class="c1"># &lt;- set the owning organisation</span>
<span class="n">domain</span><span class="nf">.create!</span> <span class="c1"># &lt;- commit</span>

</pre>
<p>To retrieve already existing domains;</p>
<pre class="highlight ruby">
<span class="n">client</span><span class="nf">.domains</span> <span class="c1"># &lt;- all domains</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="c1">#&lt;CFoundry::V2::Domain &#39;665b1cf3-e736-42cb-b7fe-bae8362fc30d&#39;&gt;]</span>

<span class="n">client</span><span class="nf">.domains_by_owning_organization_guid</span> <span class="n">client</span><span class="nf">.organizations.first</span> <span class="c1"># &lt;- domains belonging to an organization</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="c1">#&lt;CFoundry::V2::Domain &#39;665b1cf3-e736-42cb-b7fe-bae8362fc30d&#39;&gt;]</span>

<span class="n">client</span><span class="nf">.domains_by_space_guid</span> <span class="n">client</span><span class="nf">.spaces.first</span> <span class="c1"># &lt;- domains assigned to a space</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="c1">#&lt;CFoundry::V2::Domain &#39;665b1cf3-e736-42cb-b7fe-bae8362fc30d&#39;&gt;]</span>

</pre>
          </div><!-- End of content_inner -->
        </div><!-- End of container-full -->
      </div><!-- End of content -->
    </div><!-- End of non_footer -->
    <div id='footer'>
      <div id='container-footer'>
        <div class='bg_social'>
          <ul class='social'>
            <li>
            <a href='http://twitter.com/cloudfoundry' target='_blank'>
            <img alt='Twitter' src='/images/twitter_large.png'>
            </a>
            </li>
            <li>
            <a href='https://plus.google.com/114245065906861739918/posts' target='_blank'>
            <img alt='Google+' src='/images/g+_large.png'>
            </a>
            </li>
            <li>
            <a href='http://facebook.com/cloudfoundry' target='_blank'>
            <img alt='Facebook' src='/images/facebook_large.png'>
            </a>
            </li>
            <li>
            <a href='http://youtube.com/cloudfoundry' target='_blank'>
            <img alt='Youtube' src='/images/youtube_large.png'>
            </a>
            </li>
          </ul>
        </div><!-- End of bg_social -->
        <ul class='links'>
          <li>
          <a href='http://www.cloudfoundry.com/about'>About</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://blog.cloudfoundry.com/'>Blog</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://www.cloudfoundry.com/partners'>Partners</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://docs.cloudfoundry.com'>Docs</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://www.cloudfoundry.com/faq'>FAQ</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://status.cloudfoundry.com/'>Status</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://www.cloudfoundry.com/support'>Support</a>
          </li>
        </ul>
        <div class='copyright'>
          <div class='hr-horizontal-dark'></div>
          <br>
          <p>
            &copy;
            <script>
              //<![CDATA[
                var d = new Date();
                document.write(d.getFullYear());
              //]]>
            </script>
            GoPivotal, Inc. All rights reserved.
            <a href='http://www.cloudfoundry.com/terms'>Terms</a>
            <a href='http://www.gopivotal.com/privacy-policy' target='_blank'>Privacy</a>
          </p>
        </div><!-- End of copyright -->
      </div><!-- End of container-footer -->
    </div><!-- End of footer -->
    <script type="text/javascript">
      (function() {
        var didInit = false;
        function initMunchkin() {
          if(didInit === false) {
            didInit = true;
            Munchkin.init('625-IUJ-009');
          }
        }
        var s = document.createElement('script');
        s.type = 'text/javascript';
        s.async = true;
        s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
        s.onreadystatechange = function() {
          if (this.readyState == 'complete' || this.readyState == 'loaded') {
            initMunchkin();
          }
        };
        s.onload = initMunchkin;
        document.getElementsByTagName('head')[0].appendChild(s);
      })();
    </script>
  </body>
</html>
